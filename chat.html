<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zynapse - Chat</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="zynaps.png">
</head>
<body>
    <div class="chat-page" id="chatPage">
        <!-- Chat Header -->
        <header class="chat-header">
            <button class="back-btn" id="backToHomeBtn">
                <i class="fas fa-arrow-left"></i>
            </button>

            <div class="chat-user-info">
                <img src="" alt="Contact" class="profile-pic-small" id="chatProfilePic">
                <div class="chat-user-details">
                    <h3 id="chatContactName">Loading...</h3>
                    <div class="chat-status">
                        <div class="status-dot" id="chatStatusDot"></div>
                        <span id="chatStatusText">Loading...</span>
                    </div>
                </div>
            </div>

            <div class="chat-header-actions">
                <button class="icon-btn" id="voiceCallBtn">
                    <i class="fas fa-phone"></i>
                </button>
                <button class="icon-btn" id="videoCallBtn">
                    <i class="fas fa-video"></i>
                </button>
                <div class="dropdown">
                    <button class="icon-btn" id="chatMenuBtn">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <div class="dropdown-content" id="chatDropdown">
                        <a href="#" id="viewProfileBtn"><i class="fas fa-user"></i> View Profile</a>
                        <a href="#" id="addNicknameBtn"><i class="fas fa-tag"></i> Add Nickname</a>
                        <a href="#" id="addToFavoritesBtn"><i class="fas fa-star"></i> Add to Favorites</a>
                        <a href="#" id="muteChatBtn"><i class="fas fa-bell-slash"></i> Mute Notifications</a>
                        <div class="dropdown-divider"></div>
                        <a href="#" id="clearChatBtn"><i class="fas fa-broom"></i> Clear Chat</a>
                        <a href="#" id="reportUserBtn"><i class="fas fa-flag"></i> Report User</a>
                        <a href="#" id="blockUserBtn"><i class="fas fa-ban"></i> Block User</a>
                        <div class="dropdown-divider"></div>
                        <a href="#" id="deleteChatBtn" class="logout-link"><i class="fas fa-trash"></i> Delete Chat</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Chat Messages Area -->
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be loaded here -->
            <div class="empty-chat">
                <i class="fas fa-comments"></i>
                <h3>No messages yet</h3>
                <p>Say hello to start the conversation!</p>
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-bubble">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                    <span class="typing-text" id="typingText">typing...</span>
                </div>
            </div>
        </div>

        <!-- Message Input Area -->
        <div class="message-input-area">
            <button class="icon-btn" id="attachmentBtn">
                <i class="fas fa-plus"></i>
            </button>

            <div class="message-input-container">
                <input type="text" id="messageInput" placeholder="iMessage" autocomplete="off">
                <button class="icon-btn" id="emojiBtn">
                    <i class="far fa-smile"></i>
                </button>
            </div>

            <button class="send-btn" id="sendMessageBtn">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>

        <!-- Attachment Options -->
        <div class="attachment-options" id="attachmentOptions">
            <button class="attachment-btn" id="attachPhotoBtn">
                <i class="fas fa-image"></i>
                <span>Photo</span>
            </button>
            <button class="attachment-btn" id="attachVideoBtn">
                <i class="fas fa-video"></i>
                <span>Video</span>
            </button>
            <button class="attachment-btn" id="attachDocumentBtn">
                <i class="fas fa-file"></i>
                <span>Document</span>
            </button>
            <button class="attachment-btn" id="attachAudioBtn">
                <i class="fas fa-microphone"></i>
                <span>Voice</span>
            </button>
            <button class="attachment-btn" id="attachLocationBtn">
                <i class="fas fa-map-marker-alt"></i>
                <span>Location</span>
            </button>
            <button class="attachment-btn" id="attachContactBtn">
                <i class="fas fa-user-plus"></i>
                <span>Contact</span>
            </button>
        </div>

        <!-- Hidden Inputs -->
        <input type="file" id="photoUpload" accept="image/*" style="display: none;" multiple>
        <input type="file" id="videoUpload" accept="video/*" style="display: none;">
        <input type="file" id="documentUpload" accept=".pdf,.doc,.docx,.txt,.xls,.xlsx" style="display: none;">
        <input type="file" id="audioUpload" accept="audio/*" style="display: none;">

        <!-- Audio Recorder -->
        <div class="audio-recorder" id="audioRecorder" style="display: none;">
            <div class="recorder-controls">
                <button class="icon-btn" id="cancelRecordingBtn">
                    <i class="fas fa-times"></i>
                </button>
                <div class="recording-timer" id="recordingTimer">0:00</div>
                <button class="icon-btn" id="sendRecordingBtn">
                    <i class="fas fa-check"></i>
                </button>
            </div>
            <div class="recording-visualizer" id="recordingVisualizer"></div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modalOverlay">
        <!-- View Profile Modal -->
        <div class="modal-content" id="viewProfileModal">
            <div class="modal-header">
                <h3>Profile</h3>
                <button class="close-modal" id="closeViewProfileModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="profile-display">
                    <img src="" alt="Profile" class="profile-large" id="viewProfilePic">
                    <h3 id="viewProfileName">Loading...</h3>
                    <p class="user-id-display" id="viewProfileID">ZYN-0000</p>
                    <p class="user-bio" id="viewProfileBio">No bio yet</p>
                    
                    <div class="profile-info-grid">
                        <div class="info-item">
                            <i class="fas fa-phone"></i>
                            <span id="viewProfilePhone">Loading...</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-envelope"></i>
                            <span id="viewProfileEmail">Loading...</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-calendar"></i>
                            <span id="viewProfileJoined">Loading...</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-circle"></i>
                            <span id="viewProfileStatus">Loading...</span>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn-secondary" id="startCallFromProfileBtn">
                        <i class="fas fa-phone"></i> Call
                    </button>
                    <button class="btn-primary" id="messageFromProfileBtn">
                        <i class="fas fa-comment"></i> Message
                    </button>
                </div>
            </div>
        </div>

        <!-- Add Nickname Modal -->
        <div class="modal-content" id="nicknameModal">
            <div class="modal-header">
                <h3>Add Nickname</h3>
                <button class="close-modal" id="closeNicknameModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <i class="fas fa-tag"></i>
                    <input type="text" id="nicknameInput" placeholder="Enter nickname">
                </div>
                <div class="modal-actions">
                    <button class="btn-primary" id="saveNicknameBtn">
                        <i class="fas fa-save"></i> Save Nickname
                    </button>
                </div>
            </div>
        </div>

        <!-- Location Picker Modal -->
        <div class="modal-content" id="locationModal">
            <div class="modal-header">
                <h3>Share Location</h3>
                <button class="close-modal" id="closeLocationModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="location-map" id="locationMap">
                    <!-- Map will be loaded here -->
                    <div class="map-placeholder">
                        <i class="fas fa-map-marker-alt"></i>
                        <p>Loading map...</p>
                    </div>
                </div>
                <div class="location-details" id="locationDetails">
                    <h4>Current Location</h4>
                    <p id="locationAddress">Fetching address...</p>
                    <p id="locationCoordinates">Fetching coordinates...</p>
                </div>
                <div class="modal-actions">
                    <button class="btn-primary" id="shareLocationBtn">
                        <i class="fas fa-share"></i> Share Location
                    </button>
                </div>
            </div>
        </div>

        <!-- Media Viewer Modal -->
        <div class="modal-content" id="mediaViewerModal">
            <div class="modal-header">
                <h3 id="mediaViewerTitle">Media</h3>
                <button class="close-modal" id="closeMediaViewerModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="media-viewer" id="mediaViewer">
                    <!-- Media will be displayed here -->
                </div>
                <div class="media-info" id="mediaInfo">
                    <p>Sent by <span id="mediaSender">Unknown</span></p>
                    <p id="mediaTimestamp">Just now</p>
                </div>
                <div class="media-actions">
                    <button class="btn-media" id="downloadMediaBtn">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="btn-media" id="shareMediaBtn">
                        <i class="fas fa-share"></i>
                    </button>
                    <button class="btn-media" id="deleteMediaBtn">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Report User Modal -->
        <div class="modal-content" id="reportModal">
            <div class="modal-header">
                <h3>Report User</h3>
                    <button class="close-modal" id="closeReportModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="report-form">
                    <div class="input-group">
                        <label>Reason for Report</label>
                        <select id="reportReason">
                            <option value="spam">Spam</option>
                            <option value="harassment">Harassment</option>
                            <option value="inappropriate">Inappropriate Content</option>
                            <option value="impersonation">Impersonation</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Additional Details</label>
                        <textarea id="reportDetails" placeholder="Please provide more details..." rows="4"></textarea>
                    </div>
                    <p class="form-hint">Your report will be reviewed within 24 hours. False reports may result in account suspension.</p>
                </div>
                <div class="modal-actions">
                    <button class="btn-danger" id="submitReportBtn">
                        <i class="fas fa-flag"></i> Submit Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div class="modal-content" id="confirmationModal">
            <div class="modal-header">
                <h3 id="confirmationTitle">Confirm Action</h3>
                <button class="close-modal" id="closeConfirmationModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="confirmation-message">
                    <i class="fas fa-exclamation-triangle warning-icon"></i>
                    <h4 id="confirmationMessage">Are you sure you want to perform this action?</h4>
                    <p id="confirmationDetails">This action cannot be undone.</p>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" id="confirmCancelBtn">Cancel</button>
                    <button class="btn-danger" id="confirmActionBtn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Audio for notifications -->
    <audio id="notificationSound" preload="auto">
        <source src="notification.mp3" type="audio/mpeg">
    </audio>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBrVtSAOckpj8_fRA3-0kI7vAzOpXDUqxs&callback=initMap" async defer></script>
    <script src="app.js"></script>
    <script>
        // Chat page specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            initializeChatPage();
        });
    </script>
</body>
</html>
