<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zynapse</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="icon" type="image/x-icon" href="#">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Cloudinary Upload Widget -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :root {
            --white: #ffffff;
            --black: #000000;
            --gray-50: #f9f9f9;
            --gray-100: #f2f2f2;
            --gray-200: #e9e9e9;
            --gray-300: #d9d9d9;
            --gray-400: #b0b0b0;
            --gray-500: #8e8e93;
            --gray-600: #6d6d72;
            --gray-700: #3a3a3c;
            --blue: #007aff;
            --blue-light: #5ac8fa;
            --blue-dark: #0056cc;
            --green: #34c759;
            --green-light: #4cd964;
            --red: #ff3b30;
            --red-light: #ff5757;
            --red-dark: #d70015;
            --orange: #ff9500;
            --purple: #af52de;
            --yellow: #ffcc00;
            --shadow-light: 0 2px 10px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-heavy: 0 8px 30px rgba(0, 0, 0, 0.12);
            --border-radius-small: 10px;
            --border-radius-medium: 16px;
            --border-radius-large: 20px;
            --border-radius-circle: 50%;
            --font-sf-pro: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.4s ease;
        }

        body {
            font-family: var(--font-sf-pro);
            background: var(--white);
            color: var(--black);
            line-height: 1.4;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            height: 100vh;
            width: 100vw;
            position: fixed;
        }

        #app {
            height: 100%;
            width: 100%;
            position: relative;
        }

        /* ===== LOADING SCREEN ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--white);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity var(--transition-slow);
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-content {
            text-align: center;
            padding: 20px;
        }

        .loading-logo {
            width: 100px;
            height: 100px;
            margin-bottom: 30px;
            border-radius: var(--border-radius-large);
            object-fit: cover;
            animation: pulse 2s infinite;
        }

        .spinner-large {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 122, 255, 0.1);
            border-top-color: var(--blue);
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }

        .loading-content p {
            color: var(--gray-600);
            font-size: 16px;
            font-weight: 500;
        }

        /* ===== AUTHENTICATION PAGES ===== */
        .auth-page {
            background: var(--white);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-y: auto;
        }

        .auth-container {
            width: 100%;
            max-width: 400px;
            animation: fadeIn 0.5s ease;
        }

        .welcome-screen {
            text-align: center;
            animation: slideUp 0.6s ease;
        }

        .logo-large {
            width: 120px;
            height: 120px;
            margin: 0 auto 24px;
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-medium);
            object-fit: cover;
            transition: transform var(--transition-normal);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            font-weight: bold;
        }

        .logo-large:hover {
            transform: scale(1.05);
        }

        .welcome-screen h1 {
            font-size: 42px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .tagline {
            font-size: 17px;
            color: var(--gray-600);
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .powered-by {
            font-size: 14px;
            color: var(--gray-500);
            margin-bottom: 40px;
            font-weight: 500;
        }

        .welcome-actions {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 30px;
        }

        .welcome-footer {
            padding-top: 20px;
            border-top: 1px solid var(--gray-200);
            font-size: 14px;
            color: var(--gray-500);
        }

        .welcome-footer .link {
            color: var(--blue);
            text-decoration: none;
            font-weight: 500;
        }

        .welcome-footer .link:hover {
            text-decoration: underline;
        }

        /* Auth Forms */
        .auth-form {
            background: var(--white);
            border-radius: var(--border-radius-large);
            padding: 36px;
            box-shadow: var(--shadow-heavy);
            animation: slideUp 0.4s ease;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 32px;
            position: relative;
        }

        .back-btn {
            position: absolute;
            left: 0;
            top: 0;
            background: none;
            border: none;
            color: var(--gray-500);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: var(--border-radius-circle);
            transition: all var(--transition-normal);
        }

        .back-btn:hover {
            background: var(--gray-100);
            color: var(--black);
        }

        .logo-small {
            width: 64px;
            height: 64px;
            border-radius: var(--border-radius-medium);
            margin-bottom: 20px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            font-weight: bold;
            margin: 0 auto 20px;
        }

        .auth-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 8px;
        }

        .auth-header p {
            font-size: 16px;
            color: var(--gray-600);
        }

        .auth-form-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-group {
            position: relative;
        }

        .input-group i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-500);
            font-size: 18px;
            z-index: 1;
        }

        .input-group input {
            width: 100%;
            padding: 18px 20px 18px 48px;
            font-size: 17px;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius-medium);
            background: var(--white);
            color: var(--black);
            transition: all var(--transition-normal);
            font-family: var(--font-sf-pro);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .input-group input::placeholder {
            color: var(--gray-400);
        }

        .input-group input:invalid:not(:focus):not(:placeholder-shown) {
            border-color: var(--red);
        }

        .toggle-password {
            left: auto !important;
            right: 16px;
            cursor: pointer;
            transition: color var(--transition-normal);
        }

        .toggle-password:hover {
            color: var(--blue);
        }

        /* Form Options */
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 15px;
            color: var(--gray-600);
            user-select: none;
        }

        .checkbox-container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .checkmark {
            position: relative;
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 10px;
            background: var(--white);
            border: 2px solid var(--gray-300);
            border-radius: 6px;
            transition: all var(--transition-normal);
        }

        .checkbox-container input:checked ~ .checkmark {
            background: var(--blue);
            border-color: var(--blue);
        }

        .checkbox-container input:checked ~ .checkmark::after {
            content: "âœ“";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--white);
            font-size: 14px;
            font-weight: bold;
        }

        /* Profile Upload Section */
        .profile-upload-section {
            margin: 20px 0;
        }

        .upload-label {
            display: block;
            margin-bottom: 12px;
            font-size: 15px;
            font-weight: 500;
            color: var(--gray-700);
        }

        .profile-upload-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
        }

        .upload-preview {
            width: 100px;
            height: 100px;
            border-radius: var(--border-radius-circle);
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px dashed var(--gray-300);
            transition: all var(--transition-normal);
            position: relative;
        }

        .upload-preview:hover {
            border-color: var(--blue);
            background: rgba(0, 122, 255, 0.02);
        }

        .preview-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
        }

        .preview-placeholder i {
            font-size: 32px;
            color: var(--gray-400);
            margin-bottom: 8px;
        }

        .preview-placeholder span,
        .preview-placeholder p {
            font-size: 13px;
            color: var(--gray-500);
            line-height: 1.3;
        }

        .upload-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }

        .btn-upload {
            background: var(--white);
            color: var(--blue);
            border: 2px solid var(--blue);
            padding: 12px 20px;
            border-radius: var(--border-radius-medium);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-upload:hover:not(:disabled) {
            background: var(--blue);
            color: var(--white);
        }

        .btn-upload:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-remove {
            background: var(--white);
            color: var(--red);
            border: 2px solid var(--red);
            padding: 10px 20px;
            border-radius: var(--border-radius-medium);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-remove:hover:not(:disabled) {
            background: var(--red);
            color: var(--white);
        }

        .upload-hint {
            font-size: 13px;
            color: var(--gray-500);
            margin-top: 5px;
        }

        /* Terms Agreement */
        .terms-agreement {
            margin: 10px 0;
        }

        .terms-agreement .link {
            color: var(--blue);
            text-decoration: none;
        }

        .terms-agreement .link:hover {
            text-decoration: underline;
        }

        /* Divider */
        .auth-divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: var(--gray-400);
        }

        .auth-divider::before,
        .auth-divider::after {
            content: "";
            flex: 1;
            height: 1px;
            background: var(--gray-200);
        }

        .auth-divider span {
            padding: 0 15px;
            font-size: 14px;
        }

        /* Google Button */
        .btn-google {
            background: var(--white);
            color: var(--gray-700);
            border: 2px solid var(--gray-300);
            padding: 16px 20px;
            border-radius: var(--border-radius-medium);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
        }

        .btn-google:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }

        .btn-google i {
            color: #DB4437;
        }

        /* Auth Switch Links */
        .auth-switch {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-200);
            font-size: 15px;
            color: var(--gray-600);
        }

        .auth-switch .link {
            color: var(--blue);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-switch .link:hover {
            text-decoration: underline;
        }

        /* Full Width Button */
        .full-width {
            width: 100%;
        }

        /* Buttons */
        .btn-primary {
            background: var(--blue);
            color: var(--white);
            border: none;
            padding: 18px 32px;
            border-radius: var(--border-radius-medium);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            letter-spacing: -0.3px;
            position: relative;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--blue-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--white);
            color: var(--blue);
            border: 2px solid var(--blue);
            padding: 16px 32px;
            border-radius: var(--border-radius-medium);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--blue);
            color: var(--white);
        }

        .btn-secondary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-danger {
            background: var(--red);
            color: var(--white);
            border: none;
            padding: 16px 32px;
            border-radius: var(--border-radius-medium);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-danger:hover:not(:disabled) {
            background: var(--red-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }

        .btn-danger:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Media Buttons */
        .btn-media {
            background: var(--gray-100);
            color: var(--gray-600);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: var(--border-radius-circle);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all var(--transition-normal);
        }

        .btn-media:hover {
            background: var(--gray-200);
            color: var(--blue);
        }

        /* Link Styling */
        .link {
            color: var(--blue);
            text-decoration: none;
            transition: color var(--transition-normal);
        }

        .link:hover {
            text-decoration: underline;
        }

        /* Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ===== APP HOME PAGE ===== */
        .app-home {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: var(--white);
            position: relative;
        }

        .app-header {
            background: var(--white);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-200);
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 100;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-logo {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-small);
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-info h2 {
            font-size: 18px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 2px;
            line-height: 1.2;
        }

        .user-id-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-id {
            font-size: 14px;
            color: var(--gray-600);
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            letter-spacing: 0.5px;
        }

        .copy-btn {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            padding: 4px;
            border-radius: var(--border-radius-small);
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
        }

        .copy-btn:hover {
            color: var(--blue);
            background: var(--gray-100);
        }

        .copy-btn.copied {
            color: var(--green);
        }

        /* Status Indicator */
        .status-indicator {
            position: relative;
            cursor: pointer;
            padding: 8px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: var(--border-radius-circle);
            background: var(--green);
            border: 2px solid var(--white);
            box-shadow: 0 0 0 2px var(--green);
        }

        .status-indicator.online .status-dot {
            background: var(--green);
            box-shadow: 0 0 0 2px var(--green);
        }

        .status-indicator.offline .status-dot {
            background: var(--gray-400);
            box-shadow: 0 0 0 2px var(--gray-400);
        }

        .status-indicator.away .status-dot {
            background: var(--orange);
            box-shadow: 0 0 0 2px var(--orange);
        }

        .profile-pic-small {
            width: 36px;
            height: 36px;
            border-radius: var(--border-radius-circle);
            object-fit: cover;
            border: 2px solid var(--gray-200);
            transition: border-color var(--transition-normal);
        }

        .profile-pic-small:hover {
            border-color: var(--blue);
        }

        .profile-btn {
            background: none;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--border-radius-medium);
            transition: background var(--transition-normal);
        }

        .profile-btn:hover {
            background: var(--gray-100);
        }

        /* Navigation */
        .app-nav {
            display: flex;
            justify-content: space-around;
            padding: 12px 20px;
            background: var(--white);
            border-top: 1px solid var(--gray-200);
            position: sticky;
            bottom: 0;
            z-index: 99;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            color: var(--gray-500);
            padding: 8px 16px;
            border-radius: var(--border-radius-medium);
            transition: all var(--transition-normal);
            position: relative;
            background: none;
            border: none;
            cursor: pointer;
            font-family: inherit;
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item span {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: color var(--transition-normal);
        }

        .nav-item.active {
            color: var(--blue);
        }

        .nav-item.active span {
            color: var(--blue);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--blue);
            border-radius: var(--border-radius-circle);
        }

        .nav-item:hover:not(.active) {
            color: var(--gray-700);
            background: var(--gray-100);
        }

        .badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--red);
            color: var(--white);
            font-size: 10px;
            font-weight: 700;
            min-width: 18px;
            height: 18px;
            border-radius: var(--border-radius-circle);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            animation: badgePulse 2s infinite;
        }

        @keyframes badgePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Main Content */
        .app-main {
            flex: 1;
            overflow-y: auto;
            background: var(--white);
            padding: 20px;
            position: relative;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
            height: 100%;
        }

        .page.active {
            display: block;
        }

        .home-content {
            text-align: center;
            padding: 20px;
        }

        .welcome-message h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 12px;
        }

        .welcome-message p {
            font-size: 18px;
            color: var(--gray-600);
            margin-bottom: 40px;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 40px;
        }

        .quick-action-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-medium);
            padding: 24px 16px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .quick-action-card:hover {
            transform: translateY(-2px);
            border-color: var(--blue);
            box-shadow: var(--shadow-medium);
        }

        .quick-action-card i {
            font-size: 32px;
            color: var(--blue);
            margin-bottom: 12px;
        }

        .quick-action-card h3 {
            font-size: 17px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: 4px;
        }

        .quick-action-card p {
            font-size: 14px;
            color: var(--gray-600);
        }

        /* Recent Chats Section */
        .recent-chats-section {
            background: var(--white);
            border-radius: var(--border-radius-medium);
            padding: 20px;
            border: 1px solid var(--gray-200);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
        }

        .view-all {
            color: var(--blue);
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            transition: color var(--transition-normal);
        }

        .view-all:hover {
            color: var(--blue-dark);
            text-decoration: underline;
        }

        .recent-chats-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Page Headers */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--gray-200);
        }

        .page-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: var(--black);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .tabs {
            display: flex;
            background: var(--gray-100);
            border-radius: var(--border-radius-medium);
            padding: 4px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius-small);
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .tab-btn.active {
            background: var(--white);
            color: var(--blue);
            box-shadow: var(--shadow-light);
        }

        .search-box {
            display: flex;
            align-items: center;
            background: var(--gray-100);
            border-radius: var(--border-radius-medium);
            padding: 10px 16px;
            width: 250px;
        }

        .search-box i {
            color: var(--gray-500);
            margin-right: 10px;
        }

        .search-box input {
            flex: 1;
            background: none;
            border: none;
            font-size: 16px;
            color: var(--black);
            outline: none;
        }

        .search-box input::placeholder {
            color: var(--gray-400);
        }

        /* Floating Button */
        .floating-btn {
            position: fixed;
            bottom: 80px;
            right: 30px;
            background: var(--blue);
            color: var(--white);
            border: none;
            width: 60px;
            height: 60px;
            border-radius: var(--border-radius-circle);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            box-shadow: var(--shadow-heavy);
            transition: all var(--transition-normal);
            z-index: 1000;
            animation: pulse 2s infinite;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-heavy), 0 0 30px rgba(0, 122, 255, 0.4);
        }

        .floating-btn:active {
            transform: scale(0.95);
        }

        .floating-btn i {
            font-size: 20px;
        }

        .floating-btn span {
            font-size: 10px;
            font-weight: 600;
        }

        /* Modals */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--border-radius-large);
            padding: 0;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-heavy);
            animation: modalSlideUp 0.4s ease;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--white);
            border-radius: var(--border-radius-large) var(--border-radius-large) 0 0;
            z-index: 1;
        }

        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            color: var(--gray-500);
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-circle);
            transition: all var(--transition-normal);
        }

        .close-modal:hover {
            background: var(--gray-100);
            color: var(--black);
        }

        .modal-body {
            padding: 24px;
        }

        .search-result {
            margin: 20px 0;
            padding: 20px;
            background: var(--gray-50);
            border-radius: var(--border-radius-medium);
            display: none;
        }

        .search-result.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .search-placeholder {
            text-align: center;
            padding: 20px;
            color: var(--gray-500);
        }

        .search-placeholder i {
            font-size: 32px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .search-placeholder p {
            font-size: 15px;
        }

        .user-found {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--white);
            border-radius: var(--border-radius-medium);
            border: 1px solid var(--gray-200);
            animation: slideUp 0.3s ease;
        }

        .user-found .profile-pic {
            width: 50px;
            height: 50px;
            border-radius: var(--border-radius-circle);
            object-fit: cover;
        }

        .user-found h4 {
            font-size: 17px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: 4px;
        }

        .user-found p {
            font-size: 14px;
            color: var(--gray-600);
        }

        .already-contact {
            color: var(--green) !important;
            font-weight: 500;
            margin-top: 4px;
        }

        .error {
            color: var(--red) !important;
            text-align: center;
            padding: 10px;
        }

        /* Character Counter */
        .character-counter {
            text-align: right;
            font-size: 14px;
            color: var(--gray-500);
            margin-top: 8px;
        }

        /* Media Preview */
        .media-preview {
            margin: 16px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 100px;
        }

        .media-preview-content {
            width: 100%;
            text-align: center;
        }

        .preview-item {
            width: 100px;
            height: 100px;
            border-radius: var(--border-radius-small);
            overflow: hidden;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        .preview-item img,
        .preview-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-preview {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: var(--white);
            border: none;
            width: 24px;
            height: 24px;
            border-radius: var(--border-radius-circle);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
        }

        .remove-preview:hover {
            background: var(--red);
            transform: scale(1.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            justify-content: flex-end;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .media-buttons {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            justify-content: center;
        }

        /* Members Container */
        .members-container {
            margin: 20px 0;
            background: var(--gray-50);
            border-radius: var(--border-radius-medium);
            padding: 20px;
        }

        .members-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .members-header h4 {
            font-size: 17px;
            font-weight: 600;
            color: var(--black);
        }

        .members-count {
            font-size: 14px;
            color: var(--gray-600);
        }

        .members-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 60px;
        }

        .empty-members {
            width: 100%;
            text-align: center;
            padding: 20px;
            color: var(--gray-500);
        }

        .empty-members i {
            font-size: 32px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .empty-members p {
            font-size: 15px;
        }

        .member-tag {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-large);
            padding: 8px 12px;
            font-size: 14px;
            color: var(--gray-700);
            animation: slideUp 0.3s ease;
        }

        .remove-member {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            padding: 2px;
            border-radius: var(--border-radius-circle);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            transition: all var(--transition-normal);
        }

        .remove-member:hover {
            color: var(--red);
            background: var(--gray-100);
        }

        /* Lists Containers */
        .requests-container,
        .contacts-container,
        .groups-container,
        .zynes-container,
        .chats-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Request Card */
        .request-card,
        .contact-card,
        .group-card,
        .chat-card {
            background: var(--white);
            border-radius: var(--border-radius-medium);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            border: 1px solid var(--gray-200);
            transition: all var(--transition-normal);
            cursor: pointer;
            animation: fadeIn 0.3s ease;
        }

        .request-card:hover,
        .contact-card:hover,
        .group-card:hover,
        .chat-card:hover {
            border-color: var(--blue);
            box-shadow: var(--shadow-light);
            transform: translateY(-1px);
        }

        .request-card .profile-pic,
        .contact-card .profile-pic,
        .group-card .profile-pic,
        .chat-card .profile-pic {
            width: 50px;
            height: 50px;
            border-radius: var(--border-radius-circle);
            object-fit: cover;
        }

        .request-info,
        .contact-info,
        .group-info,
        .chat-info {
            flex: 1;
        }

        .request-info h4,
        .contact-info h4,
        .group-info h4,
        .chat-info h4 {
            font-size: 17px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: 4px;
        }

        .request-info p,
        .contact-info p,
        .group-info p,
        .chat-info p {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 2px;
        }

        .request-info .time,
        .contact-info .time,
        .group-info .time,
        .chat-info .time {
            font-size: 13px;
            color: var(--gray-500);
        }

        .contact-info .status {
            font-size: 13px;
            font-weight: 500;
        }

        .contact-info .status.online {
            color: var(--green);
        }

        .contact-info .status.offline {
            color: var(--gray-500);
        }

        .request-actions,
        .contact-actions,
        .group-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 8px 16px;
            border-radius: var(--border-radius-medium);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            border: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .accept-btn {
            background: var(--green);
            color: var(--white);
        }

        .accept-btn:hover {
            background: #2db34a;
            transform: translateY(-1px);
        }

        .reject-btn {
            background: var(--red);
            color: var(--white);
        }

        .reject-btn:hover {
            background: #e53935;
            transform: translateY(-1px);
        }

        .chat-btn {
            background: var(--blue);
            color: var(--white);
        }

        .chat-btn:hover {
            background: var(--blue-dark);
            transform: translateY(-1px);
        }

        /* Dropdowns */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: var(--white);
            min-width: 220px;
            border-radius: var(--border-radius-medium);
            box-shadow: var(--shadow-heavy);
            z-index: 1000;
            border: 1px solid var(--gray-200);
            animation: dropdownFade 0.2s ease;
            margin-top: 8px;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
        }

        .dropdown-profile-pic {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-circle);
            object-fit: cover;
        }

        .dropdown-profile-info {
            display: flex;
            flex-direction: column;
        }

        .dropdown-profile-info strong {
            font-size: 15px;
            color: var(--black);
            margin-bottom: 2px;
        }

        .dropdown-profile-info span {
            font-size: 13px;
            color: var(--gray-600);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--gray-200);
            margin: 8px 0;
        }

        .dropdown-content a {
            color: var(--black);
            padding: 12px 16px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 15px;
            transition: all var(--transition-normal);
            border-bottom: 1px solid var(--gray-100);
        }

        .dropdown-content a:last-child {
            border-bottom: none;
        }

        .dropdown-content a:hover {
            background: var(--gray-100);
            color: var(--blue);
        }

        .logout-link {
            color: var(--red) !important;
        }

        .logout-link:hover {
            color: var(--white) !important;
            background: var(--red) !important;
        }

        /* Chat Page */
        .chat-page {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: var(--white);
            position: relative;
        }

        .chat-header {
            background: var(--white);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-200);
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 100;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        .chat-back-btn {
            background: none;
            border: none;
            color: var(--blue);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: var(--border-radius-circle);
            transition: background var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }

        .chat-back-btn:hover {
            background: var(--gray-100);
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }

        .chat-user-details {
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .chat-user-details h3 {
            font-size: 17px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .chat-status .status-dot {
            width: 8px;
            height: 8px;
            border-radius: var(--border-radius-circle);
        }

        .chat-status .status-dot.online {
            background: var(--green);
        }

        .chat-status .status-dot.offline {
            background: var(--gray-400);
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--gray-600);
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: var(--border-radius-circle);
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }

        .icon-btn:hover {
            background: var(--gray-100);
            color: var(--black);
        }

        /* Chat Messages Area */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--white);
            display: flex;
            flex-direction: column;
            gap: 16px;
            position: relative;
        }

        /* Custom Scrollbar */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }

        /* Empty Chat */
        .empty-chat {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .empty-chat i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-chat h3 {
            font-size: 20px;
            margin-bottom: 8px;
            color: var(--gray-600);
        }

        .empty-chat p {
            font-size: 16px;
            max-width: 300px;
            margin: 0 auto;
        }

        /* Message Date */
        .message-date {
            text-align: center;
            color: var(--gray-500);
            font-size: 13px;
            font-weight: 600;
            margin: 20px 0;
            padding: 8px 16px;
            background: var(--gray-100);
            border-radius: var(--border-radius-large);
            align-self: center;
            letter-spacing: 0.3px;
        }

        /* Message Bubbles */
        .message {
            display: flex;
            margin-bottom: 8px;
            animation: messageSlide 0.3s ease;
        }

        .message.sent {
            justify-content: flex-end;
        }

        .message.received {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: var(--border-radius-large);
            position: relative;
            word-wrap: break-word;
            line-height: 1.4;
            box-shadow: var(--shadow-light);
        }

        .message.sent .message-bubble {
            background: var(--blue);
            color: var(--white);
            border-bottom-right-radius: var(--border-radius-small);
            margin-left: auto;
        }

        .message.received .message-bubble {
            background: var(--gray-100);
            color: var(--black);
            border-bottom-left-radius: var(--border-radius-small);
            margin-right: auto;
        }

        .message-bubble p {
            font-size: 17px;
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            display: block;
            text-align: right;
            margin-top: 4px;
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        .message.sent .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .message.received .message-time {
            color: var(--gray-600);
        }

        .message-status {
            font-size: 11px;
            margin-left: 4px;
        }

        /* Media Messages */
        .media-message {
            max-width: 250px;
        }

        .chat-media {
            width: 100%;
            border-radius: var(--border-radius-medium);
            margin-bottom: 8px;
            box-shadow: var(--shadow-light);
            cursor: pointer;
            transition: transform var(--transition-normal);
        }

        .chat-media:hover {
            transform: scale(1.02);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-items: center;
            margin-bottom: 8px;
            padding-left: 16px;
            animation: fadeIn 0.3s ease;
        }

        .typing-bubble {
            background: var(--gray-100);
            border-radius: var(--border-radius-large);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--gray-500);
            border-radius: var(--border-radius-circle);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        .typing-text {
            font-size: 13px;
            color: var(--gray-600);
            font-weight: 500;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }

        /* Message Input Area */
        .message-input-area {
            background: var(--white);
            padding: 12px 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: 12px;
            position: sticky;
            bottom: 0;
            z-index: 100;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        .message-input-container {
            flex: 1;
            background: var(--gray-100);
            border-radius: var(--border-radius-large);
            padding: 0 16px;
            display: flex;
            align-items: center;
            transition: all var(--transition-normal);
        }

        .message-input-container:focus-within {
            background: var(--white);
            box-shadow: 0 0 0 2px var(--blue-light);
        }

        .message-input-container input {
            flex: 1;
            background: none;
            border: none;
            padding: 14px 0;
            font-size: 17px;
            color: var(--black);
            font-family: var(--font-sf-pro);
        }

        .message-input-container input:focus {
            outline: none;
        }

        .message-input-container input::placeholder {
            color: var(--gray-500);
        }

        .send-btn {
            background: var(--blue);
            color: var(--white);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-circle);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
        }

        .send-btn:hover:not(:disabled) {
            background: var(--blue-dark);
            transform: scale(1.05);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Attachment Options */
        .attachment-options {
            position: absolute;
            bottom: 70px;
            left: 20px;
            background: var(--white);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--shadow-heavy);
            padding: 12px;
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            z-index: 1000;
            border: 1px solid var(--gray-200);
            animation: slideUp 0.3s ease;
        }

        .attachment-options.show {
            display: grid;
        }

        .attachment-btn {
            background: none;
            border: none;
            padding: 12px 8px;
            border-radius: var(--border-radius-medium);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all var(--transition-normal);
            color: var(--black);
            font-size: 13px;
            min-width: 80px;
        }

        .attachment-btn:hover {
            background: var(--gray-100);
            color: var(--blue);
            transform: translateY(-2px);
        }

        .attachment-btn i {
            font-size: 20px;
        }

        /* Confirmation Messages */
        .confirmation-message {
            text-align: center;
            padding: 20px;
        }

        .confirmation-message .warning-icon {
            font-size: 48px;
            color: var(--orange);
            margin-bottom: 16px;
        }

        .confirmation-message h4 {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 8px;
        }

        .confirmation-message p {
            font-size: 16px;
            color: var(--gray-600);
            line-height: 1.4;
        }

        /* Report Form */
        .report-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .report-form .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .report-form label {
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-700);
        }

        .report-form select,
        .report-form textarea {
            width: 100%;
            padding: 14px 16px;
            font-size: 16px;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius-medium);
            background: var(--white);
            color: var(--black);
            font-family: var(--font-sf-pro);
            transition: border-color var(--transition-normal);
        }

        .report-form select:focus,
        .report-form textarea:focus {
            outline: none;
            border-color: var(--blue);
        }

        .report-form textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-hint {
            font-size: 14px;
            color: var(--gray-500);
            margin-top: 8px;
            line-height: 1.4;
        }

        /* Zynes Posts */
        .zyne-post {
            background: var(--white);
            border-radius: var(--border-radius-medium);
            border: 1px solid var(--gray-200);
            margin-bottom: 20px;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
        }

        .zyne-header {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
        }

        .zyne-header .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-circle);
            object-fit: cover;
            margin-right: 12px;
        }

        .zyne-user-info {
            flex: 1;
        }

        .zyne-user-info h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: 2px;
        }

        .zyne-user-info p {
            font-size: 13px;
            color: var(--gray-500);
        }

        .zyne-menu {
            position: relative;
        }

        .zyne-content {
            padding: 16px;
        }

        .zyne-text {
            font-size: 16px;
            line-height: 1.4;
            color: var(--black);
            margin-bottom: 16px;
        }

        .zyne-media {
            width: 100%;
            border-radius: var(--border-radius-medium);
            margin-bottom: 16px;
        }

        .zyne-actions {
            display: flex;
            justify-content: space-between;
            padding: 0 16px 16px;
            border-top: 1px solid var(--gray-200);
            padding-top: 16px;
        }

        .zyne-action-btn {
            background: none;
            border: none;
            color: var(--gray-600);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: var(--border-radius-medium);
            transition: all var(--transition-normal);
        }

        .zyne-action-btn:hover {
            background: var(--gray-100);
            color: var(--blue);
        }

        .zyne-action-btn.active {
            color: var(--red);
        }

        .zyne-stats {
            padding: 0 16px 16px;
            font-size: 14px;
            color: var(--gray-500);
        }

        .zyne-comments {
            border-top: 1px solid var(--gray-200);
            padding: 16px;
            display: none;
        }

        .zyne-comments.show {
            display: block;
        }

        .comment-form {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .comment-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-large);
            font-size: 15px;
            outline: none;
        }

        .comment-input:focus {
            border-color: var(--blue);
        }

        .comment-btn {
            background: var(--blue);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-large);
            padding: 0 20px;
            cursor: pointer;
            font-weight: 600;
        }

        .comment-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .comment-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .comment-item:last-child {
            border-bottom: none;
        }

        .comment-author {
            font-weight: 600;
            color: var(--black);
            margin-bottom: 4px;
        }

        .comment-text {
            font-size: 14px;
            color: var(--gray-700);
            line-height: 1.4;
        }

        .comment-time {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        /* Create Zyne Modal */
        .create-zyne {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .zyne-textarea {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius-medium);
            font-size: 16px;
            font-family: var(--font-sf-pro);
            resize: vertical;
            outline: none;
            transition: border-color var(--transition-normal);
        }

        .zyne-textarea:focus {
            border-color: var(--blue);
        }

        /* Group Creation */
        .group-creation {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Profile View */
        .profile-view {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }

        .profile-view-pic {
            width: 120px;
            height: 120px;
            border-radius: var(--border-radius-circle);
            object-fit: cover;
            border: 4px solid var(--gray-100);
        }

        .profile-view-info {
            text-align: center;
        }

        .profile-view-info h3 {
            font-size: 24px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 8px;
        }

        .profile-view-info p {
            font-size: 16px;
            color: var(--gray-600);
            margin-bottom: 4px;
        }

        .profile-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes dropdownFade {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Toast Notifications Container */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        /* Toast Notifications */
        .toast {
            background: var(--black);
            color: var(--white);
            padding: 16px 20px;
            border-radius: var(--border-radius-medium);
            box-shadow: var(--shadow-heavy);
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
            max-width: 100%;
        }

        .toast::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            animation: toastProgress 3s linear forwards;
        }

        .toast.success {
            background: var(--green);
        }

        .toast.error {
            background: var(--red);
        }

        .toast.warning {
            background: var(--orange);
        }

        .toast.info {
            background: var(--blue);
        }

        .toast i {
            font-size: 20px;
        }

        .toast span {
            flex: 1;
            font-size: 15px;
            line-height: 1.4;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        @keyframes toastProgress {
            from { width: 100%; }
            to { width: 0%; }
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 8px;
            color: var(--gray-600);
        }

        .empty-state p {
            font-size: 16px;
            max-width: 300px;
            margin: 0 auto;
            line-height: 1.4;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .auth-form {
                padding: 24px;
            }
            
            .app-nav span {
                display: none;
            }
            
            .app-nav {
                justify-content: space-between;
                padding: 12px 16px;
            }
            
            .nav-item {
                padding: 12px;
            }
            
            .nav-item.active::after {
                top: -8px;
            }
            
            .message-bubble {
                max-width: 85%;
            }
            
            .floating-btn span {
                display: none;
            }
            
            .floating-btn {
                width: 56px;
                height: 56px;
                bottom: 70px;
                right: 20px;
            }
            
            .quick-actions {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .search-box {
                width: 200px;
            }
            
            .attachment-options {
                grid-template-columns: repeat(2, 1fr);
                left: 10px;
                right: 10px;
                justify-content: center;
            }
            
            .modal-content {
                width: 95%;
                max-height: 85vh;
            }
            
            .toast-container {
                left: 20px;
                right: 20px;
                max-width: none;
            }
            
            .toast {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .welcome-screen h1 {
                font-size: 36px;
            }
            
            .auth-header h2 {
                font-size: 24px;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .page-header h2 {
                font-size: 24px;
            }
            
            .header-actions {
                width: 100%;
            }
            
            .search-box {
                width: 100%;
            }
            
            .chat-messages {
                padding: 16px;
            }
            
            .message-input-area {
                padding: 12px 16px;
            }
            
            .chat-header {
                padding: 12px 16px;
            }
            
            .modal-content {
                width: 100%;
                height: 100%;
                max-height: 100vh;
                border-radius: 0;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .modal-header {
                padding: 20px;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .profile-upload-container {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .upload-buttons {
                width: 100%;
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            z-index: 10;
            border-radius: inherit;
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .nav-item:hover:not(.active) {
                background: transparent;
            }
            
            .copy-btn:hover,
            .icon-btn:hover,
            .profile-btn:hover {
                background: transparent;
            }
            
            .btn-primary:hover:not(:disabled),
            .btn-secondary:hover:not(:disabled),
            .btn-danger:hover:not(:disabled) {
                transform: none;
            }
            
            .floating-btn:hover {
                transform: none;
            }
            
            .request-card:hover,
            .contact-card:hover,
            .group-card:hover {
                transform: none;
            }
            
            .attachment-btn:hover {
                transform: none;
            }
            
            .chat-media:hover {
                transform: none;
            }
            
            .action-btn:hover {
                transform: none;
            }
            
            .remove-preview:hover {
                transform: none;
            }
            
            input,
            textarea,
            select,
            button {
                font-size: 16px !important; /* Prevents zoom on iOS */
            }
        }

        /* Print Styles */
        @media print {
            .floating-btn,
            .message-input-area,
            .app-nav,
            .profile-btn,
            .copy-btn,
            .back-btn,
            .icon-btn,
            .close-modal,
            .toast-container,
            .attachment-options {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .app-main {
                padding: 0 !important;
            }
            
            .chat-messages {
                height: auto !important;
                overflow: visible !important;
            }
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            :root {
                --blue: #0040ff;
                --green: #008000;
                --red: #c00000;
                --gray-500: #000000;
            }
            
            .input-group input {
                border-width: 3px;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Loading Screen -->
        <div class="loading-screen" id="loadingScreen">
            <div class="loading-content">
                <div class="loading-logo">Z</div>
                <div class="spinner-large"></div>
                <p>Loading Zynapse...</p>
            </div>
        </div>

        <!-- Welcome Screen -->
        <div class="auth-page" id="welcomeScreen" style="display: none;">
            <div class="auth-container">
                <div class="welcome-screen">
                    <div class="logo-large">Z</div>
                    <h1>Zynapse</h1>
                    <p class="tagline">Connect instantly with secure, real-time messaging</p>
                    <p class="tagline">Share moments, create groups, and stay connected</p>
                    <p class="powered-by">Powered by Buffer Zone</p>
                    
                    <div class="welcome-actions">
                        <button class="btn-primary full-width" id="signupBtn">
                            <i class="fas fa-user-plus"></i> Create Account
                        </button>
                        <button class="btn-secondary full-width" id="loginBtn">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                    </div>
                    
                    <div class="welcome-footer">
                        By continuing, you agree to our <a href="#" class="link">Terms</a> and <a href="#" class="link">Privacy Policy</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sign Up Page -->
        <div class="auth-page" id="signupPage" style="display: none;">
            <div class="auth-container">
                <div class="auth-form">
                    <div class="auth-header">
                        <button class="back-btn" id="backToWelcome">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="logo-small">Z</div>
                        <h2>Create Account</h2>
                        <p>Join Zynapse to start connecting</p>
                    </div>
                    
                    <div class="auth-form-content">
                        <div class="input-group">
                            <i class="fas fa-user"></i>
                            <input type="text" id="signupName" placeholder="Full Name" required>
                        </div>
                        
                        <div class="input-group">
                            <i class="fas fa-phone"></i>
                            <input type="tel" id="signupPhone" placeholder="Phone Number" required>
                        </div>
                        
                        <div class="input-group">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="signupEmail" placeholder="Email Address" required>
                        </div>
                        
                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="signupPassword" placeholder="Password" required>
                            <i class="fas fa-eye toggle-password"></i>
                        </div>
                        
                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="signupConfirmPassword" placeholder="Confirm Password" required>
                            <i class="fas fa-eye toggle-password"></i>
                        </div>
                        
                        <div class="profile-upload-section">
                            <label class="upload-label">Profile Picture</label>
                            <div class="profile-upload-container">
                                <div class="upload-preview" id="profilePreview">
                                    <div class="preview-placeholder">
                                        <i class="fas fa-user-circle"></i>
                                        <span>No image selected</span>
                                        <p>Max 5MB</p>
                                    </div>
                                </div>
                                <div class="upload-buttons">
                                    <button class="btn-upload" id="uploadProfileBtn">
                                        <i class="fas fa-upload"></i> Upload Photo
                                    </button>
                                    <button class="btn-remove" id="removeProfileBtn" style="display: none;">
                                        <i class="fas fa-trash"></i> Remove
                                    </button>
                                </div>
                            </div>
                            <p class="upload-hint">JPEG, PNG or GIF â€¢ Max 5MB</p>
                            <input type="hidden" id="profileImageUrl">
                        </div>
                        
                        <div class="terms-agreement">
                            <label class="checkbox-container">
                                <input type="checkbox" id="agreeTerms" required>
                                <span class="checkmark"></span>
                                I agree to the <a href="#" class="link">Terms of Service</a> and <a href="#" class="link">Privacy Policy</a>
                            </label>
                        </div>
                        
                        <button class="btn-primary full-width" id="registerBtn">
                            <span>Create Account</span>
                        </button>
                        
                        <div class="auth-divider">
                            <span>Or continue with</span>
                        </div>
                        
                        <button class="btn-google" id="googleSignup">
                            <i class="fab fa-google"></i> Google
                        </button>
                        
                        <div class="auth-switch">
                            Already have an account? <a href="#" class="link" id="switchToLogin">Sign In</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Page -->
        <div class="auth-page" id="loginPage" style="display: none;">
            <div class="auth-container">
                <div class="auth-form">
                    <div class="auth-header">
                        <button class="back-btn" id="backToWelcomeFromLogin">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="logo-small">Z</div>
                        <h2>Welcome Back</h2>
                        <p>Sign in to your Zynapse account</p>
                    </div>
                    
                    <div class="auth-form-content">
                        <div class="input-group">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="loginEmail" placeholder="Email Address" required>
                        </div>
                        
                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="loginPassword" placeholder="Password" required>
                            <i class="fas fa-eye toggle-password"></i>
                        </div>
                        
                        <div class="form-options">
                            <label class="checkbox-container">
                                <input type="checkbox" id="rememberMe">
                                <span class="checkmark"></span>
                                Remember me
                            </label>
                            <a href="#" class="link" id="forgotPassword">Forgot Password?</a>
                        </div>
                        
                        <button class="btn-primary full-width" id="signinBtn">
                            <span>Sign In</span>
                        </button>
                        
                        <div class="auth-divider">
                            <span>Or continue with</span>
                        </div>
                        
                        <button class="btn-google" id="googleLogin">
                            <i class="fab fa-google"></i> Google
                        </button>
                        
                        <div class="auth-switch">
                            Don't have an account? <a href="#" class="link" id="switchToSignup">Create Account</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div class="app-home" id="mainApp" style="display: none;">
            <!-- Header -->
            <header class="app-header">
                <div class="header-left">
                    <div class="header-logo">Z</div>
                    <div class="user-info">
                        <h2 id="headerUserName">Loading...</h2>
                        <div class="user-id-container">
                            <span class="user-id" id="headerUserID">ZYN-0000</span>
                            <button class="copy-btn" id="copyUserIdBtn">
                                <i class="far fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="dropdown">
                        <button class="profile-btn" id="profileDropdownBtn">
                            <img src="" alt="Profile" class="profile-pic-small" id="headerProfilePic">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-content" id="profileDropdown">
                            <div class="dropdown-profile">
                                <img src="" alt="Profile" class="dropdown-profile-pic" id="dropdownProfilePic">
                                <div class="dropdown-profile-info">
                                    <strong id="dropdownUserName">User Name</strong>
                                    <span id="dropdownUserID">ZYN-0000</span>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="#" id="viewProfileBtn"><i class="fas fa-user"></i> View Profile</a>
                            <a href="#" id="settingsBtn"><i class="fas fa-cog"></i> Settings</a>
                            <a href="#" id="themeBtn"><i class="fas fa-palette"></i> Theme</a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="logout-link" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Navigation -->
            <nav class="app-nav">
                <button class="nav-item active" data-page="home">
                    <i class="fas fa-home"></i>
                    <span>HOME</span>
                </button>
                <button class="nav-item" data-page="zynes">
                    <i class="fas fa-stream"></i>
                    <span>ZYNES</span>
                    <span class="badge" id="zynesBadge" style="display: none;">0</span>
                </button>
                <button class="nav-item" data-page="groups">
                    <i class="fas fa-users"></i>
                    <span>GROUPS</span>
                    <span class="badge" id="groupsBadge" style="display: none;">0</span>
                </button>
                <button class="nav-item" data-page="requests">
                    <i class="fas fa-user-plus"></i>
                    <span>REQUESTS</span>
                    <span class="badge" id="requestsBadge" style="display: none;">0</span>
                </button>
                <button class="nav-item" data-page="contacts">
                    <i class="fas fa-address-book"></i>
                    <span>CONTACTS</span>
                </button>
            </nav>
            
            <!-- Main Content -->
            <main class="app-main">
                <!-- Home Page -->
                <div class="page active" id="homePage">
                    <div class="home-content">
                        <div class="welcome-message">
                            <h1>Welcome to Zynapse</h1>
                            <p>Secure messaging with Buffer Zone technology</p>
                        </div>
                        
                        <div class="quick-actions">
                            <div class="quick-action-card" id="startChatCard">
                                <i class="fas fa-comment"></i>
                                <h3>Start Chat</h3>
                                <p>Begin a new conversation</p>
                            </div>
                            <div class="quick-action-card" id="createGroupCard">
                                <i class="fas fa-users"></i>
                                <h3>Create Group</h3>
                                <p>Start a group chat</p>
                            </div>
                            <div class="quick-action-card" id="postZyneCard">
                                <i class="fas fa-stream"></i>
                                <h3>Post Zyne</h3>
                                <p>Share a status update</p>
                            </div>
                            <div class="quick-action-card" id="addContactCard">
                                <i class="fas fa-user-plus"></i>
                                <h3>Add Contact</h3>
                                <p>Find and add friends</p>
                            </div>
                        </div>
                        
                        <div class="recent-chats-section">
                            <div class="section-header">
                                <h3>Recent Chats</h3>
                                <a href="#" class="view-all">View All</a>
                            </div>
                            <div class="recent-chats-list" id="recentChatsList">
                                <!-- Recent chats will be loaded here -->
                                <div class="empty-state">
                                    <i class="fas fa-comments"></i>
                                    <h3>No chats yet</h3>
                                    <p>Start a conversation by clicking the chat button</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Zynes Page -->
                <div class="page" id="zynesPage">
                    <div class="page-header">
                        <h2>Zynes</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Search Zynes..." id="searchZynes">
                            </div>
                            <button class="btn-primary" id="createZyneBtn">
                                <i class="fas fa-plus"></i> Create
                            </button>
                        </div>
                    </div>
                    
                    <div class="zynes-container" id="zynesContainer">
                        <!-- Zynes will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-stream"></i>
                            <h3>No Zynes yet</h3>
                            <p>Share your first status update</p>
                        </div>
                    </div>
                </div>
                
                <!-- Groups Page -->
                <div class="page" id="groupsPage">
                    <div class="page-header">
                        <h2>Groups</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Search groups..." id="searchGroups">
                            </div>
                            <button class="btn-primary" id="createGroupBtn">
                                <i class="fas fa-plus"></i> New Group
                            </button>
                        </div>
                    </div>
                    
                    <div class="groups-container" id="groupsContainer">
                        <!-- Groups will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>No groups yet</h3>
                            <p>Create your first group chat</p>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Requests Page -->
                <div class="page" id="requestsPage">
                    <div class="page-header">
                        <h2>Chat Requests</h2>
                        <div class="tabs">
                            <button class="tab-btn active" data-tab="incoming">Incoming</button>
                            <button class="tab-btn" data-tab="sent">Sent</button>
                        </div>
                    </div>
                    
                    <div class="requests-container" id="incomingRequests">
                        <!-- Incoming requests will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-user-plus"></i>
                            <h3>No incoming requests</h3>
                            <p>When someone sends you a chat request, it will appear here</p>
                        </div>
                    </div>
                    
                    <div class="requests-container" id="sentRequests" style="display: none;">
                        <!-- Sent requests will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-paper-plane"></i>
                            <h3>No sent requests</h3>
                            <p>When you send a chat request, it will appear here</p>
                        </div>
                    </div>
                </div>
                
                <!-- Contacts Page -->
                <div class="page" id="contactsPage">
                    <div class="page-header">
                        <h2>Contacts</h2>
                        <div class="header-actions">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Search contacts..." id="searchContacts">
                            </div>
                            <button class="btn-primary" id="addContactBtn">
                                <i class="fas fa-user-plus"></i> Add
                            </button>
                        </div>
                    </div>
                    
                    <div class="contacts-container" id="contactsContainer">
                        <!-- Contacts will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-address-book"></i>
                            <h3>No contacts yet</h3>
                            <p>Add contacts to start chatting</p>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Floating Start Chat Button -->
            <button class="floating-btn" id="floatingChatBtn">
                <i class="fas fa-comment"></i>
                <span>Chat</span>
            </button>
        </div>

        <!-- Chat Page -->
        <div class="chat-page" id="chatPage" style="display: none;">
            <header class="chat-header">
                <button class="chat-back-btn" id="chatBackBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                
                <div class="chat-user-info">
                    <img src="" alt="Profile" class="profile-pic-small" id="chatProfilePic">
                    <div class="chat-user-details">
                        <h3 id="chatUserName">User Name</h3>
                        <div class="chat-status">
                            <span class="status-dot" id="chatStatusDot"></span>
                            <span id="chatStatusText">Online</span>
                        </div>
                    </div>
                </div>
                
                <div class="chat-actions">
                    <button class="icon-btn" id="chatMenuBtn">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </header>
            
            <!-- Chat Menu Dropdown -->
            <div class="dropdown-content" id="chatMenuDropdown" style="position: absolute; top: 60px; right: 20px; display: none;">
                <a href="#" id="addNicknameBtn"><i class="fas fa-tag"></i> Add Nickname</a>
                <a href="#" id="viewChatProfileBtn"><i class="fas fa-user"></i> View Profile</a>
                <a href="#" id="blockUserBtn"><i class="fas fa-ban"></i> Block User</a>
                <a href="#" id="addToFavoritesBtn"><i class="fas fa-star"></i> Add to Favorites</a>
                <div class="dropdown-divider"></div>
                <a href="#" id="reportChatBtn" style="color: var(--red);"><i class="fas fa-flag"></i> Report</a>
                <a href="#" id="deleteChatBtn" style="color: var(--red);"><i class="fas fa-trash"></i> Delete Chat</a>
            </div>
            
            <!-- Chat Messages Area -->
            <div class="chat-messages" id="chatMessages">
                <div class="empty-chat">
                    <i class="fas fa-comments"></i>
                    <h3>No messages yet</h3>
                    <p>Send a message to start the conversation</p>
                </div>
            </div>
            
            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-bubble">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                    <span class="typing-text">typing...</span>
                </div>
            </div>
            
            <!-- Message Input Area -->
            <div class="message-input-area">
                <button class="btn-media" id="attachmentBtn">
                    <i class="fas fa-plus"></i>
                </button>
                
                <!-- Attachment Options -->
                <div class="attachment-options" id="attachmentOptions">
                    <button class="attachment-btn" data-type="image">
                        <i class="fas fa-image"></i>
                        <span>Photo</span>
                    </button>
                    <button class="attachment-btn" data-type="video">
                        <i class="fas fa-video"></i>
                        <span>Video</span>
                    </button>
                    <button class="attachment-btn" data-type="file">
                        <i class="fas fa-file"></i>
                        <span>File</span>
                    </button>
                </div>
                
                <div class="message-input-container">
                    <input type="text" placeholder="iMessage" id="messageInput">
                </div>
                
                <button class="send-btn" id="sendMessageBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- Modals -->
        
        <!-- Start Chat Modal -->
        <div class="modal-overlay" id="startChatModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Start New Chat</h3>
                    <button class="close-modal" id="closeStartChatModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <i class="fas fa-id-card"></i>
                        <input type="text" id="searchUserId" placeholder="Enter User ID (ZYN-XXXX)" maxlength="8">
                    </div>
                    
                    <div class="search-result" id="userSearchResult">
                        <div class="search-placeholder">
                            <i class="fas fa-search"></i>
                            <p>Enter a User ID to search for users</p>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn-secondary" id="cancelStartChat">Cancel</button>
                        <button class="btn-primary" id="sendChatRequestBtn" style="display: none;">Send Chat Request</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Create Group Modal -->
        <div class="modal-overlay" id="createGroupModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Create New Group</h3>
                    <button class="close-modal" id="closeCreateGroupModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="group-creation">
                        <div class="input-group">
                            <i class="fas fa-users"></i>
                            <input type="text" id="groupName" placeholder="Group Name">
                        </div>
                        
                        <div class="profile-upload-section">
                            <label class="upload-label">Group Photo</label>
                            <div class="profile-upload-container">
                                <div class="upload-preview" id="groupProfilePreview">
                                    <div class="preview-placeholder">
                                        <i class="fas fa-users"></i>
                                        <span>No image selected</span>
                                    </div>
                                </div>
                                <div class="upload-buttons">
                                    <button class="btn-upload" id="uploadGroupProfileBtn">
                                        <i class="fas fa-upload"></i> Upload
                                    </button>
                                </div>
                            </div>
                            <input type="hidden" id="groupProfileImageUrl">
                        </div>
                        
                        <div class="members-container">
                            <div class="members-header">
                                <h4>Add Members</h4>
                                <span class="members-count">0 members</span>
                            </div>
                            <div class="members-list" id="groupMembersList">
                                <div class="empty-members">
                                    <i class="fas fa-user-plus"></i>
                                    <p>Add members by User ID</p>
                                </div>
                            </div>
                            <div class="input-group" style="margin-top: 16px;">
                                <i class="fas fa-id-card"></i>
                                <input type="text" id="addMemberInput" placeholder="Enter User ID to add member">
                                <button class="btn-media" id="addMemberBtn" style="position: absolute; right: 10px;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn-secondary" id="cancelCreateGroup">Cancel</button>
                            <button class="btn-primary" id="createGroupConfirmBtn">Create Group</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Create Zyne Modal -->
        <div class="modal-overlay" id="createZyneModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Create Zyne</h3>
                    <button class="close-modal" id="closeCreateZyneModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="create-zyne">
                        <textarea class="zyne-textarea" id="zyneText" placeholder="What's on your mind?"></textarea>
                        <div class="character-counter">
                            <span id="zyneCharCount">0</span>/500
                        </div>
                        
                        <div class="media-preview" id="zyneMediaPreview"></div>
                        
                        <div class="media-buttons">
                            <button class="btn-media" id="addZynePhotoBtn">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="btn-media" id="addZyneVideoBtn">
                                <i class="fas fa-video"></i>
                            </button>
                            <button class="btn-remove" id="removeZyneMediaBtn" style="display: none;">
                                <i class="fas fa-trash"></i> Remove Media
                            </button>
                        </div>
                        
                        <input type="hidden" id="zyneMediaUrl">
                        <input type="hidden" id="zyneMediaType">
                        
                        <div class="modal-actions">
                            <button class="btn-secondary" id="cancelCreateZyne">Cancel</button>
                            <button class="btn-primary" id="postZyneBtn">Post Zyne</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Add Contact Modal -->
        <div class="modal-overlay" id="addContactModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Contact</h3>
                    <button class="close-modal" id="closeAddContactModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <i class="fas fa-id-card"></i>
                        <input type="text" id="searchContactId" placeholder="Enter User ID (ZYN-XXXX)" maxlength="8">
                    </div>
                    
                    <div class="search-result" id="contactSearchResult">
                        <div class="search-placeholder">
                            <i class="fas fa-search"></i>
                            <p>Enter a User ID to search for users</p>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn-secondary" id="cancelAddContact">Cancel</button>
                        <button class="btn-primary" id="sendContactRequestBtn" style="display: none;">Send Request</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Profile View Modal -->
        <div class="modal-overlay" id="profileViewModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Profile</h3>
                    <button class="close-modal" id="closeProfileViewModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="profile-view">
                        <img src="" alt="Profile" class="profile-view-pic" id="profileViewPic">
                        <div class="profile-view-info">
                            <h3 id="profileViewName">User Name</h3>
                            <p id="profileViewId">ZYN-0000</p>
                            <p id="profileViewEmail">user@example.com</p>
                            <p id="profileViewPhone">+1234567890</p>
                            <p id="profileViewStatus">Last seen recently</p>
                        </div>
                        
                        <div class="profile-actions">
                            <button class="btn-primary" id="startChatFromProfileBtn">
                                <i class="fas fa-comment"></i> Chat
                            </button>
                            <button class="btn-secondary" id="removeContactFromProfileBtn">
                                <i class="fas fa-user-minus"></i> Remove
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Confirmation Modal -->
        <div class="modal-overlay" id="confirmationModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="confirmationTitle">Confirm Action</h3>
                    <button class="close-modal" id="closeConfirmationModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="confirmation-message">
                        <i class="fas fa-exclamation-triangle warning-icon"></i>
                        <h4 id="confirmationMessage">Are you sure you want to proceed?</h4>
                        <p id="confirmationDetails">This action cannot be undone.</p>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn-secondary" id="cancelConfirmation">Cancel</button>
                        <button class="btn-danger" id="confirmAction">Confirm</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Report Modal -->
        <div class="modal-overlay" id="reportModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Report User</h3>
                    <button class="close-modal" id="closeReportModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="report-form">
                        <div class="input-group">
                            <label for="reportReason">Reason for Report</label>
                            <select id="reportReason">
                                <option value="">Select a reason</option>
                                <option value="spam">Spam</option>
                                <option value="harassment">Harassment</option>
                                <option value="inappropriate">Inappropriate Content</option>
                                <option value="impersonation">Impersonation</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="reportDetails">Additional Details</label>
                            <textarea id="reportDetails" placeholder="Please provide more details about your report..."></textarea>
                            <div class="character-counter">
                                <span id="reportCharCount">0</span>/1000
                            </div>
                        </div>
                        
                        <p class="form-hint">Your report will be reviewed by our team. We take all reports seriously.</p>
                        
                        <div class="modal-actions">
                            <button class="btn-secondary" id="cancelReport">Cancel</button>
                            <button class="btn-danger" id="submitReport">Submit Report</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <script>
        // ===== APP CONFIGURATION =====
        const CONFIG = {
            firebase: {
                apiKey: "AIzaSyBrVtSAOckpj8_fRA3-0kI7vAzOpXDUqxs",
                authDomain: "zynapse-68181.firebaseapp.com",
                databaseURL: "https://zynapse-68181-default-rtdb.firebaseio.com",
                projectId: "zynapse-68181",
                storageBucket: "zynapse-68181.firebasestorage.app",
                messagingSenderId: "841353050519",
                appId: "1:841353050519:web:3b16d95d8f4cd3b9506cd2",
                measurementId: "G-4764XLL6WS"
            },
            cloudinary: {
                cloudName: 'dd3lcymrk',
                uploadPreset: 'h3eyhc2o',
                folder: 'zynapse/profiles',
                maxFileSize: 50000000 // 50MB
            }
        };

        // ===== GLOBAL VARIABLES =====
        let currentUser = null;
        let currentChat = null;
        let currentPage = 'home';
        let userData = {};
        let contacts = [];
        let chatRequests = [];
        let groups = [];
        let zynes = [];
        let recentChats = [];
        let cloudinaryWidget = null;
        let notificationSound = null;

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Firebase
            firebase.initializeApp(CONFIG.firebase);
            
            // Create notification sound
            notificationSound = new Audio('data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAAAwAAAbYAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/zYMQAHMgGAFAAAAAASU1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV');
            
            // Load Cloudinary widget
            cloudinaryWidget = cloudinary.createUploadWidget({
                cloudName: CONFIG.cloudinary.cloudName,
                uploadPreset: CONFIG.cloudinary.uploadPreset,
                folder: CONFIG.cloudinary.folder,
                maxFileSize: CONFIG.cloudinary.maxFileSize,
                resourceType: 'auto',
                multiple: false,
                clientAllowedFormats: ['image', 'video', 'pdf', 'doc', 'docx', 'txt'],
                showPoweredBy: false
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    handleCloudinaryUpload(result);
                }
            });
            
            // Initialize UI
            initializeUI();
            
            // Check authentication state
            checkAuthState();
        });

        // ===== FIREBASE AUTHENTICATION =====
        function checkAuthState() {
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    loadUserData();
                } else {
                    // User is signed out
                    showScreen('welcomeScreen');
                }
                hideLoading();
            });
        }

        async function loadUserData() {
            try {
                const userRef = firebase.database().ref('users/' + currentUser.uid);
                const snapshot = await userRef.once('value');
                
                if (snapshot.exists()) {
                    userData = snapshot.val();
                    showScreen('mainApp');
                    updateUIWithUserData();
                    loadUserContacts();
                    loadChatRequests();
                    loadGroups();
                    loadZynes();
                    loadRecentChats();
                } else {
                    // User data doesn't exist, sign out
                    await firebase.auth().signOut();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                showToast('Error loading user data', 'error');
            }
        }

        // ===== USER REGISTRATION =====
        async function registerUser(name, phone, email, password, profileImage) {
            try {
                showLoading();
                
                // Create user with email and password
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Generate user ID
                const userId = 'ZYN-' + Math.floor(1000 + Math.random() * 9000);
                
                // Create user data object
                const userData = {
                    uid: user.uid,
                    name: name,
                    phone: phone,
                    email: email,
                    userId: userId,
                    profileImage: profileImage || 'https://via.placeholder.com/150',
                    status: 'online',
                    lastSeen: Date.now(),
                    createdAt: Date.now(),
                    contacts: {},
                    chatRequests: {},
                    groups: {},
                    zynes: {}
                };
                
                // Save user data to database
                await firebase.database().ref('users/' + user.uid).set(userData);
                
                // Save user ID mapping
                await firebase.database().ref('userIds/' + userId).set(user.uid);
                
                showToast('Account created successfully!', 'success');
                
                // Auto login
                currentUser = user;
                showScreen('mainApp');
                updateUIWithUserData();
                
            } catch (error) {
                console.error('Registration error:', error);
                showToast(error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // ===== USER LOGIN =====
        async function loginUser(email, password) {
            try {
                showLoading();
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                showToast('Login successful!', 'success');
            } catch (error) {
                console.error('Login error:', error);
                showToast(error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // ===== UI FUNCTIONS =====
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.auth-page, .app-home, .chat-page').forEach(screen => {
                screen.style.display = 'none';
            });
            
            // Show requested screen
            document.getElementById(screenId).style.display = 'flex';
            
            // Reset modals
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.classList.remove('active');
            });
            
            // Reset dropdowns
            document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        }

        function showLoading() {
            document.getElementById('loadingScreen').classList.remove('hidden');
        }

        function hideLoading() {
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
            }, 500);
        }

        function updateUIWithUserData() {
            // Update header
            document.getElementById('headerUserName').textContent = userData.name;
            document.getElementById('headerUserID').textContent = userData.userId;
            document.getElementById('headerProfilePic').src = userData.profileImage;
            
            // Update dropdown
            document.getElementById('dropdownUserName').textContent = userData.name;
            document.getElementById('dropdownUserID').textContent = userData.userId;
            document.getElementById('dropdownProfilePic').src = userData.profileImage;
        }

        function navigateToPage(pageId) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.nav-item[data-page="${pageId}"]`).classList.add('active');
            
            // Update pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId + 'Page').classList.add('active');
            
            currentPage = pageId;
        }

        // ===== MODAL FUNCTIONS =====
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showConfirmation(title, message, details, callback) {
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationMessage').textContent = message;
            document.getElementById('confirmationDetails').textContent = details;
            
            const confirmBtn = document.getElementById('confirmAction');
            const oldHandler = confirmBtn.onclick;
            confirmBtn.onclick = function() {
                if (callback) callback();
                hideModal('confirmationModal');
            };
            
            showModal('confirmationModal');
        }

        // ===== TOAST NOTIFICATIONS =====
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'info-circle';
            switch(type) {
                case 'success': icon = 'check-circle'; break;
                case 'error': icon = 'exclamation-circle'; break;
                case 'warning': icon = 'exclamation-triangle'; break;
            }
            
            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;
            
            toastContainer.appendChild(toast);
            
            // Remove toast after animation
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // ===== CLOUDINARY UPLOAD =====
        let currentUploadType = null;
        let currentUploadCallback = null;

        function openCloudinaryUpload(type, callback) {
            currentUploadType = type;
            currentUploadCallback = callback;
            cloudinaryWidget.open();
        }

        function handleCloudinaryUpload(result) {
            if (currentUploadCallback) {
                currentUploadCallback(result.info.secure_url, result.info.resource_type);
            }
        }

        // ===== DATA LOADING FUNCTIONS =====
        async function loadUserContacts() {
            try {
                const contactsRef = firebase.database().ref('contacts/' + currentUser.uid);
                contactsRef.on('value', (snapshot) => {
                    contacts = [];
                    if (snapshot.exists()) {
                        const contactsData = snapshot.val();
                        Object.keys(contactsData).forEach(contactId => {
                            contacts.push({
                                id: contactId,
                                ...contactsData[contactId]
                            });
                        });
                    }
                    updateContactsUI();
                });
            } catch (error) {
                console.error('Error loading contacts:', error);
            }
        }

        async function loadChatRequests() {
            try {
                const requestsRef = firebase.database().ref('chatRequests/' + currentUser.uid);
                requestsRef.on('value', (snapshot) => {
                    chatRequests = [];
                    if (snapshot.exists()) {
                        const requestsData = snapshot.val();
                        Object.keys(requestsData).forEach(requestId => {
                            if (requestsData[requestId].status === 'pending') {
                                chatRequests.push({
                                    id: requestId,
                                    ...requestsData[requestId]
                                });
                            }
                        });
                    }
                    updateRequestsUI();
                });
            } catch (error) {
                console.error('Error loading chat requests:', error);
            }
        }

        async function loadGroups() {
            try {
                const groupsRef = firebase.database().ref('groups');
                groupsRef.on('value', (snapshot) => {
                    groups = [];
                    if (snapshot.exists()) {
                        const groupsData = snapshot.val();
                        Object.keys(groupsData).forEach(groupId => {
                            if (groupsData[groupId].members && groupsData[groupId].members[currentUser.uid]) {
                                groups.push({
                                    id: groupId,
                                    ...groupsData[groupId]
                                });
                            }
                        });
                    }
                    updateGroupsUI();
                });
            } catch (error) {
                console.error('Error loading groups:', error);
            }
        }

        async function loadZynes() {
            try {
                const zynesRef = firebase.database().ref('zynes');
                zynesRef.on('value', (snapshot) => {
                    zynes = [];
                    if (snapshot.exists()) {
                        const zynesData = snapshot.val();
                        Object.keys(zynesData).forEach(zyneId => {
                            if (zynesData[zyneId].userId === currentUser.uid || 
                                contacts.some(contact => contact.id === zynesData[zyneId].userId)) {
                                zynes.push({
                                    id: zyneId,
                                    ...zynesData[zyneId]
                                });
                            }
                        });
                        // Sort by timestamp (newest first)
                        zynes.sort((a, b) => b.timestamp - a.timestamp);
                    }
                    updateZynesUI();
                });
            } catch (error) {
                console.error('Error loading zynes:', error);
            }
        }

        async function loadRecentChats() {
            try {
                const chatsRef = firebase.database().ref('chats');
                chatsRef.on('value', (snapshot) => {
                    recentChats = [];
                    if (snapshot.exists()) {
                        const chatsData = snapshot.val();
                        Object.keys(chatsData).forEach(chatId => {
                            if (chatsData[chatId].participants && 
                                chatsData[chatId].participants[currentUser.uid]) {
                                
                                // Get last message
                                const messages = chatsData[chatId].messages;
                                const lastMessage = messages ? messages[Object.keys(messages).pop()] : null;
                                
                                recentChats.push({
                                    id: chatId,
                                    ...chatsData[chatId],
                                    lastMessage: lastMessage
                                });
                            }
                        });
                        // Sort by last message timestamp
                        recentChats.sort((a, b) => {
                            const timeA = a.lastMessage ? a.lastMessage.timestamp : 0;
                            const timeB = b.lastMessage ? b.lastMessage.timestamp : 0;
                            return timeB - timeA;
                        });
                    }
                    updateRecentChatsUI();
                });
            } catch (error) {
                console.error('Error loading recent chats:', error);
            }
        }

        // ===== UI UPDATE FUNCTIONS =====
        function updateContactsUI() {
            const container = document.getElementById('contactsContainer');
            if (contacts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-address-book"></i>
                        <h3>No contacts yet</h3>
                        <p>Add contacts to start chatting</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = contacts.map(contact => `
                <div class="contact-card" data-contact-id="${contact.id}">
                    <img src="${contact.profileImage || 'https://via.placeholder.com/50'}" alt="${contact.name}" class="profile-pic">
                    <div class="contact-info">
                        <h4>${contact.name}</h4>
                        <p>${contact.userId}</p>
                        <p class="status ${contact.status || 'offline'}">${contact.status || 'Offline'}</p>
                    </div>
                    <div class="contact-actions">
                        <button class="action-btn chat-btn start-chat-btn" data-contact-id="${contact.id}">
                            <i class="fas fa-comment"></i> Chat
                        </button>
                        <button class="action-btn reject-btn remove-contact-btn" data-contact-id="${contact.id}">
                            <i class="fas fa-user-minus"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateRequestsUI() {
            const incomingContainer = document.getElementById('incomingRequests');
            const badge = document.getElementById('requestsBadge');
            
            if (chatRequests.length === 0) {
                incomingContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-plus"></i>
                        <h3>No incoming requests</h3>
                        <p>When someone sends you a chat request, it will appear here</p>
                    </div>
                `;
                badge.style.display = 'none';
            } else {
                incomingContainer.innerHTML = chatRequests.map(request => `
                    <div class="request-card" data-request-id="${request.id}">
                        <img src="${request.senderProfileImage || 'https://via.placeholder.com/50'}" alt="${request.senderName}" class="profile-pic">
                        <div class="request-info">
                            <h4>${request.senderName}</h4>
                            <p>${request.senderId}</p>
                            <p class="time">${formatTime(request.timestamp)}</p>
                        </div>
                        <div class="request-actions">
                            <button class="action-btn accept-btn accept-request-btn" data-request-id="${request.id}">
                                <i class="fas fa-check"></i> Accept
                            </button>
                            <button class="action-btn reject-btn reject-request-btn" data-request-id="${request.id}">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </div>
                    </div>
                `).join('');
                
                badge.textContent = chatRequests.length;
                badge.style.display = 'inline-block';
            }
        }

        function updateGroupsUI() {
            const container = document.getElementById('groupsContainer');
            const badge = document.getElementById('groupsBadge');
            
            if (groups.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>No groups yet</h3>
                        <p>Create your first group chat</p>
                    </div>
                `;
                badge.style.display = 'none';
            } else {
                container.innerHTML = groups.map(group => `
                    <div class="group-card" data-group-id="${group.id}">
                        <img src="${group.profileImage || 'https://via.placeholder.com/50'}" alt="${group.name}" class="profile-pic">
                        <div class="group-info">
                            <h4>${group.name}</h4>
                            <p>${Object.keys(group.members || {}).length} members</p>
                            <p class="time">Last active: ${formatTime(group.lastActive || group.createdAt)}</p>
                        </div>
                        <div class="group-actions">
                            <button class="action-btn chat-btn open-group-btn" data-group-id="${group.id}">
                                <i class="fas fa-comment"></i> Open
                            </button>
                        </div>
                    </div>
                `).join('');
                
                badge.textContent = groups.length;
                badge.style.display = 'inline-block';
            }
        }

        function updateZynesUI() {
            const container = document.getElementById('zynesContainer');
            const badge = document.getElementById('zynesBadge');
            
            if (zynes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-stream"></i>
                        <h3>No Zynes yet</h3>
                        <p>Share your first status update</p>
                    </div>
                `;
                badge.style.display = 'none';
            } else {
                container.innerHTML = zynes.map(zyne => `
                    <div class="zyne-post" data-zyne-id="${zyne.id}">
                        <div class="zyne-header">
                            <img src="${zyne.userProfileImage || 'https://via.placeholder.com/40'}" alt="${zyne.userName}" class="profile-pic">
                            <div class="zyne-user-info">
                                <h4>${zyne.userName}</h4>
                                <p>${formatTime(zyne.timestamp)}</p>
                            </div>
                            ${zyne.userId === userData.userId ? `
                            <div class="zyne-menu">
                                <button class="icon-btn delete-zyne-btn" data-zyne-id="${zyne.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            ` : ''}
                        </div>
                        <div class="zyne-content">
                            ${zyne.text ? `<div class="zyne-text">${zyne.text}</div>` : ''}
                            ${zyne.mediaUrl ? `
                                ${zyne.mediaType === 'image' ? 
                                    `<img src="${zyne.mediaUrl}" alt="Zyne media" class="zyne-media">` : 
                                    `<video src="${zyne.mediaUrl}" controls class="zyne-media"></video>`
                                }
                            ` : ''}
                        </div>
                        <div class="zyne-stats">
                            <span>${zyne.likes ? Object.keys(zyne.likes).length : 0} likes</span>
                            <span> Â· </span>
                            <span>${zyne.comments ? Object.keys(zyne.comments).length : 0} comments</span>
                        </div>
                        <div class="zyne-actions">
                            <button class="zyne-action-btn like-zyne-btn ${zyne.likes && zyne.likes[currentUser.uid] ? 'active' : ''}" data-zyne-id="${zyne.id}">
                                <i class="fas fa-heart"></i> Like
                            </button>
                            <button class="zyne-action-btn comment-zyne-btn" data-zyne-id="${zyne.id}">
                                <i class="fas fa-comment"></i> Comment
                            </button>
                            <button class="zyne-action-btn share-zyne-btn" data-zyne-id="${zyne.id}">
                                <i class="fas fa-share"></i> Share
                            </button>
                        </div>
                        <div class="zyne-comments" id="comments-${zyne.id}">
                            <!-- Comments will be loaded here -->
                        </div>
                    </div>
                `).join('');
                
                badge.textContent = zynes.length;
                badge.style.display = 'inline-block';
            }
        }

        function updateRecentChatsUI() {
            const container = document.getElementById('recentChatsList');
            
            if (recentChats.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comments"></i>
                        <h3>No chats yet</h3>
                        <p>Start a conversation by clicking the chat button</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recentChats.map(chat => {
                const isGroup = chat.type === 'group';
                const otherParticipants = Object.keys(chat.participants || {}).filter(id => id !== currentUser.uid);
                
                let chatName = 'Unknown';
                let chatImage = 'https://via.placeholder.com/50';
                
                if (isGroup) {
                    chatName = chat.name || 'Group Chat';
                    chatImage = chat.profileImage || 'https://via.placeholder.com/50';
                } else if (otherParticipants.length > 0) {
                    const otherUserId = otherParticipants[0];
                    const contact = contacts.find(c => c.id === otherUserId);
                    if (contact) {
                        chatName = contact.name;
                        chatImage = contact.profileImage || 'https://via.placeholder.com/50';
                    }
                }
                
                const lastMessage = chat.lastMessage;
                const lastMessageText = lastMessage ? 
                    (lastMessage.type === 'text' ? lastMessage.content : 
                     lastMessage.type === 'image' ? 'ðŸ“· Image' :
                     lastMessage.type === 'video' ? 'ðŸŽ¥ Video' : 'ðŸ“Ž File') : 
                    'No messages yet';
                
                return `
                    <div class="chat-card" data-chat-id="${chat.id}">
                        <img src="${chatImage}" alt="${chatName}" class="profile-pic">
                        <div class="chat-info">
                            <h4>${chatName}</h4>
                            <p>${lastMessageText}</p>
                            ${lastMessage ? `<p class="time">${formatTime(lastMessage.timestamp)}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===== CHAT FUNCTIONS =====
        async function startChatWithUser(userId) {
            try {
                // Check if chat already exists
                const chatsRef = firebase.database().ref('chats');
                const snapshot = await chatsRef.orderByChild('participants/' + currentUser.uid).equalTo(true).once('value');
                
                let existingChat = null;
                if (snapshot.exists()) {
                    const chats = snapshot.val();
                    Object.keys(chats).forEach(chatId => {
                        const chat = chats[chatId];
                        if (chat.participants && chat.participants[userId] && !chat.type) {
                            existingChat = { id: chatId, ...chat };
                        }
                    });
                }
                
                if (existingChat) {
                    // Open existing chat
                    openChat(existingChat.id, existingChat);
                } else {
                    // Create new chat
                    const chatId = 'chat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const chatData = {
                        id: chatId,
                        participants: {
                            [currentUser.uid]: true,
                            [userId]: true
                        },
                        createdAt: Date.now(),
                        lastActive: Date.now(),
                        messages: {}
                    };
                    
                    await firebase.database().ref('chats/' + chatId).set(chatData);
                    openChat(chatId, chatData);
                }
            } catch (error) {
                console.error('Error starting chat:', error);
                showToast('Error starting chat', 'error');
            }
        }

        async function openChat(chatId, chatData = null) {
            try {
                if (!chatData) {
                    const chatRef = firebase.database().ref('chats/' + chatId);
                    const snapshot = await chatRef.once('value');
                    chatData = snapshot.val();
                }
                
                currentChat = { id: chatId, ...chatData };
                
                // Get other participant info
                const otherParticipants = Object.keys(chatData.participants || {}).filter(id => id !== currentUser.uid);
                
                if (chatData.type === 'group') {
                    // Group chat
                    document.getElementById('chatUserName').textContent = chatData.name || 'Group Chat';
                    document.getElementById('chatProfilePic').src = chatData.profileImage || 'https://via.placeholder.com/36';
                    document.getElementById('chatStatusText').textContent = `${Object.keys(chatData.participants || {}).length} members`;
                } else if (otherParticipants.length > 0) {
                    // Private chat
                    const otherUserId = otherParticipants[0];
                    const userRef = firebase.database().ref('users/' + otherUserId);
                    const snapshot = await userRef.once('value');
                    
                    if (snapshot.exists()) {
                        const userInfo = snapshot.val();
                        document.getElementById('chatUserName').textContent = userInfo.name;
                        document.getElementById('chatProfilePic').src = userInfo.profileImage || 'https://via.placeholder.com/36';
                        document.getElementById('chatStatusText').textContent = userInfo.status || 'Offline';
                        document.getElementById('chatStatusDot').className = `status-dot ${userInfo.status || 'offline'}`;
                    }
                }
                
                // Load messages
                loadChatMessages(chatId);
                
                // Show chat page
                showScreen('chatPage');
                
            } catch (error) {
                console.error('Error opening chat:', error);
                showToast('Error opening chat', 'error');
            }
        }

        async function loadChatMessages(chatId) {
            try {
                const messagesRef = firebase.database().ref('chats/' + chatId + '/messages');
                messagesRef.on('value', (snapshot) => {
                    const container = document.getElementById('chatMessages');
                    
                    if (!snapshot.exists()) {
                        container.innerHTML = `
                            <div class="empty-chat">
                                <i class="fas fa-comments"></i>
                                <h3>No messages yet</h3>
                                <p>Send a message to start the conversation</p>
                            </div>
                        `;
                        return;
                    }
                    
                    const messagesData = snapshot.val();
                    const messages = [];
                    
                    Object.keys(messagesData).forEach(messageId => {
                        messages.push({
                            id: messageId,
                            ...messagesData[messageId]
                        });
                    });
                    
                    // Sort by timestamp
                    messages.sort((a, b) => a.timestamp - b.timestamp);
                    
                    // Group messages by date
                    const groupedMessages = {};
                    messages.forEach(message => {
                        const date = new Date(message.timestamp).toDateString();
                        if (!groupedMessages[date]) {
                            groupedMessages[date] = [];
                        }
                        groupedMessages[date].push(message);
                    });
                    
                    // Render messages
                    container.innerHTML = '';
                    Object.keys(groupedMessages).forEach(date => {
                        const dateElement = document.createElement('div');
                        dateElement.className = 'message-date';
                        dateElement.textContent = date;
                        container.appendChild(dateElement);
                        
                        groupedMessages[date].forEach(message => {
                            const messageElement = createMessageElement(message);
                            container.appendChild(messageElement);
                        });
                    });
                    
                    // Scroll to bottom
                    container.scrollTop = container.scrollHeight;
                });
            } catch (error) {
                console.error('Error loading messages:', error);
            }
        }

        function createMessageElement(message) {
            const isSent = message.senderId === currentUser.uid;
            const messageElement = document.createElement('div');
            messageElement.className = `message ${isSent ? 'sent' : 'received'}`;
            
            let contentHtml = '';
            if (message.type === 'text') {
                contentHtml = `<p>${message.content}</p>`;
            } else if (message.type === 'image') {
                contentHtml = `
                    <div class="media-message">
                        <img src="${message.content}" alt="Image" class="chat-media">
                        <p>${message.caption || ''}</p>
                    </div>
                `;
            } else if (message.type === 'video') {
                contentHtml = `
                    <div class="media-message">
                        <video src="${message.content}" controls class="chat-media"></video>
                        <p>${message.caption || ''}</p>
                    </div>
                `;
            } else if (message.type === 'file') {
                contentHtml = `
                    <div class="media-message">
                        <p>ðŸ“Ž File: ${message.fileName || 'Attachment'}</p>
                        <p>${message.caption || ''}</p>
                    </div>
                `;
            }
            
            const time = new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageElement.innerHTML = `
                <div class="message-bubble">
                    ${contentHtml}
                    <span class="message-time">${time}</span>
                </div>
            `;
            
            return messageElement;
        }

        async function sendMessage(content, type = 'text', caption = '', fileName = '') {
            if (!currentChat || !content) return;
            
            try {
                const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const messageData = {
                    id: messageId,
                    senderId: currentUser.uid,
                    content: content,
                    type: type,
                    timestamp: Date.now(),
                    status: 'sent'
                };
                
                if (caption) messageData.caption = caption;
                if (fileName) messageData.fileName = fileName;
                
                await firebase.database().ref('chats/' + currentChat.id + '/messages/' + messageId).set(messageData);
                
                // Update chat last active
                await firebase.database().ref('chats/' + currentChat.id + '/lastActive').set(Date.now());
                
                // Play notification sound for receiver
                notificationSound.play().catch(e => console.log('Audio play failed:', e));
                
            } catch (error) {
                console.error('Error sending message:', error);
                showToast('Error sending message', 'error');
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function formatTime(timestamp) {
            if (!timestamp) return 'Unknown time';
            
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            
            return date.toLocaleDateString();
        }

        function validateUserId(userId) {
            return /^ZYN-\d{4}$/.test(userId.toUpperCase());
        }

        // ===== EVENT LISTENERS INITIALIZATION =====
        function initializeUI() {
            // Welcome screen
            document.getElementById('signupBtn').addEventListener('click', () => showScreen('signupPage'));
            document.getElementById('loginBtn').addEventListener('click', () => showScreen('loginPage'));
            
            // Back buttons
            document.getElementById('backToWelcome').addEventListener('click', () => showScreen('welcomeScreen'));
            document.getElementById('backToWelcomeFromLogin').addEventListener('click', () => showScreen('welcomeScreen'));
            
            // Switch between auth forms
            document.getElementById('switchToLogin').addEventListener('click', (e) => {
                e.preventDefault();
                showScreen('loginPage');
            });
            
            document.getElementById('switchToSignup').addEventListener('click', (e) => {
                e.preventDefault();
                showScreen('signupPage');
            });
            
            // Toggle password visibility
            document.querySelectorAll('.toggle-password').forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('input');
                    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                    input.setAttribute('type', type);
                    this.classList.toggle('fa-eye');
                    this.classList.toggle('fa-eye-slash');
                });
            });
            
            // Profile upload
            document.getElementById('uploadProfileBtn').addEventListener('click', () => {
                openCloudinaryUpload('profile', (url, type) => {
                    document.getElementById('profileImageUrl').value = url;
                    document.getElementById('profilePreview').innerHTML = `<img src="${url}" alt="Profile Preview">`;
                    document.getElementById('removeProfileBtn').style.display = 'flex';
                });
            });
            
            document.getElementById('removeProfileBtn').addEventListener('click', () => {
                document.getElementById('profileImageUrl').value = '';
                document.getElementById('profilePreview').innerHTML = `
                    <div class="preview-placeholder">
                        <i class="fas fa-user-circle"></i>
                        <span>No image selected</span>
                        <p>Max 5MB</p>
                    </div>
                `;
                document.getElementById('removeProfileBtn').style.display = 'none';
            });
            
            // Registration
            document.getElementById('registerBtn').addEventListener('click', () => {
                const name = document.getElementById('signupName').value.trim();
                const phone = document.getElementById('signupPhone').value.trim();
                const email = document.getElementById('signupEmail').value.trim();
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('signupConfirmPassword').value;
                const profileImage = document.getElementById('profileImageUrl').value;
                const agreeTerms = document.getElementById('agreeTerms').checked;
                
                if (!name || !phone || !email || !password) {
                    showToast('Please fill in all required fields', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    showToast('Password must be at least 6 characters', 'error');
                    return;
                }
                
                if (!agreeTerms) {
                    showToast('Please agree to the terms and conditions', 'error');
                    return;
                }
                
                registerUser(name, phone, email, password, profileImage);
            });
            
            // Login
            document.getElementById('signinBtn').addEventListener('click', () => {
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;
                
                if (!email || !password) {
                    showToast('Please enter email and password', 'error');
                    return;
                }
                
                loginUser(email, password);
            });
            
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    navigateToPage(page);
                });
            });
            
            // Quick actions
            document.getElementById('startChatCard').addEventListener('click', () => showModal('startChatModal'));
            document.getElementById('createGroupCard').addEventListener('click', () => showModal('createGroupModal'));
            document.getElementById('postZyneCard').addEventListener('click', () => showModal('createZyneModal'));
            document.getElementById('addContactCard').addEventListener('click', () => showModal('addContactModal'));
            
            // Floating button
            document.getElementById('floatingChatBtn').addEventListener('click', () => showModal('startChatModal'));
            
            // Copy user ID
            document.getElementById('copyUserIdBtn').addEventListener('click', async function() {
                try {
                    await navigator.clipboard.writeText(userData.userId);
                    this.classList.add('copied');
                    this.innerHTML = '<i class="fas fa-check"></i>';
                    showToast('User ID copied to clipboard', 'success');
                    
                    setTimeout(() => {
                        this.classList.remove('copied');
                        this.innerHTML = '<i class="far fa-copy"></i>';
                    }, 2000);
                } catch (error) {
                    showToast('Failed to copy User ID', 'error');
                }
            });
            
            // Profile dropdown
            document.getElementById('profileDropdownBtn').addEventListener('click', function() {
                document.getElementById('profileDropdown').classList.toggle('show');
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.dropdown')) {
                    document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                        dropdown.classList.remove('show');
                    });
                }
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', async (e) => {
                e.preventDefault();
                showConfirmation(
                    'Logout',
                    'Are you sure you want to logout?',
                    'You will need to sign in again to access your account.',
                    async () => {
                        try {
                            await firebase.auth().signOut();
                            showToast('Logged out successfully', 'success');
                        } catch (error) {
                            showToast('Error logging out', 'error');
                        }
                    }
                );
            });
            
            // View profile
            document.getElementById('viewProfileBtn').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('profileViewName').textContent = userData.name;
                document.getElementById('profileViewId').textContent = userData.userId;
                document.getElementById('profileViewEmail').textContent = userData.email;
                document.getElementById('profileViewPhone').textContent = userData.phone;
                document.getElementById('profileViewPic').src = userData.profileImage;
                document.getElementById('profileViewStatus').textContent = 'Online';
                showModal('profileViewModal');
            });
            
            // Start chat modal
            document.getElementById('searchUserId').addEventListener('input', async function() {
                const userId = this.value.toUpperCase();
                const resultDiv = document.getElementById('userSearchResult');
                
                if (!validateUserId(userId)) {
                    resultDiv.innerHTML = `
                        <div class="search-placeholder">
                            <i class="fas fa-search"></i>
                            <p>Enter a valid User ID (ZYN-XXXX)</p>
                        </div>
                    `;
                    document.getElementById('sendChatRequestBtn').style.display = 'none';
                    return;
                }
                
                try {
                    // Find user by ID
                    const userIdRef = firebase.database().ref('userIds/' + userId);
                    const snapshot = await userIdRef.once('value');
                    
                    if (!snapshot.exists()) {
                        resultDiv.innerHTML = `
                            <div class="error">
                                <p>User not found</p>
                            </div>
                        `;
                        document.getElementById('sendChatRequestBtn').style.display = 'none';
                        return;
                    }
                    
                    const userUid = snapshot.val();
                    const userRef = firebase.database().ref('users/' + userUid);
                    const userSnapshot = await userRef.once('value');
                    
                    if (userSnapshot.exists()) {
                        const userInfo = userSnapshot.val();
                        
                        // Check if already a contact
                        const isContact = contacts.some(contact => contact.id === userUid);
                        
                        resultDiv.innerHTML = `
                            <div class="user-found">
                                <img src="${userInfo.profileImage || 'https://via.placeholder.com/50'}" alt="${userInfo.name}" class="profile-pic">
                                <div>
                                    <h4>${userInfo.name}</h4>
                                    <p>${userInfo.userId}</p>
                                    ${isContact ? `<p class="already-contact">Already in your contacts</p>` : ''}
                                </div>
                            </div>
                        `;
                        
                        // Store found user data
                        resultDiv.setAttribute('data-found-user-id', userUid);
                        resultDiv.setAttribute('data-found-user-name', userInfo.name);
                        resultDiv.setAttribute('data-found-user-profile', userInfo.profileImage || '');
                        
                        document.getElementById('sendChatRequestBtn').style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error searching user:', error);
                    resultDiv.innerHTML = `
                        <div class="error">
                            <p>Error searching for user</p>
                        </div>
                    `;
                    document.getElementById('sendChatRequestBtn').style.display = 'none';
                }
            });
            
            // Send chat request
            document.getElementById('sendChatRequestBtn').addEventListener('click', async function() {
                const resultDiv = document.getElementById('userSearchResult');
                const foundUserId = resultDiv.getAttribute('data-found-user-id');
                
                if (!foundUserId) {
                    showToast('Please search for a user first', 'error');
                    return;
                }
                
                try {
                    const requestId = 'req_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const requestData = {
                        id: requestId,
                        senderId: currentUser.uid,
                        senderName: userData.name,
                        senderIdFormatted: userData.userId,
                        senderProfileImage: userData.profileImage,
                        receiverId: foundUserId,
                        timestamp: Date.now(),
                        status: 'pending'
                    };
                    
                    // Save to receiver's requests
                    await firebase.database().ref('chatRequests/' + foundUserId + '/' + requestId).set(requestData);
                    
                    // Save to sender's sent requests
                    await firebase.database().ref('sentRequests/' + currentUser.uid + '/' + requestId).set({
                        ...requestData,
                        receiverName: resultDiv.getAttribute('data-found-user-name'),
                        receiverProfileImage: resultDiv.getAttribute('data-found-user-profile')
                    });
                    
                    showToast('Chat request sent successfully', 'success');
                    hideModal('startChatModal');
                    document.getElementById('searchUserId').value = '';
                    resultDiv.innerHTML = `
                        <div class="search-placeholder">
                            <i class="fas fa-search"></i>
                            <p>Enter a User ID to search for users</p>
                        </div>
                    `;
                    
                } catch (error) {
                    console.error('Error sending chat request:', error);
                    showToast('Error sending chat request', 'error');
                }
            });
            
            // Close modals
            document.querySelectorAll('.close-modal, .btn-secondary[id^="cancel"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modalId = this.closest('.modal-overlay').id;
                    hideModal(modalId);
                });
            });
            
            // Chat page
            document.getElementById('chatBackBtn').addEventListener('click', () => {
                showScreen('mainApp');
                currentChat = null;
            });
            
            // Send message
            document.getElementById('sendMessageBtn').addEventListener('click', () => {
                const input = document.getElementById('messageInput');
                const message = input.value.trim();
                
                if (message) {
                    sendMessage(message, 'text');
                    input.value = '';
                }
            });
            
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    document.getElementById('sendMessageBtn').click();
                }
            });
            
            // Attachment button
            document.getElementById('attachmentBtn').addEventListener('click', function() {
                document.getElementById('attachmentOptions').classList.toggle('show');
            });
            
            // Attachment options
            document.querySelectorAll('.attachment-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    openCloudinaryUpload(type, (url, resourceType) => {
                        const fileType = resourceType === 'image' ? 'image' : 
                                       resourceType === 'video' ? 'video' : 'file';
                        const fileName = url.split('/').pop();
                        
                        sendMessage(url, fileType, '', fileName);
                        document.getElementById('attachmentOptions').classList.remove('show');
                    });
                });
            });
            
            // Chat menu
            document.getElementById('chatMenuBtn').addEventListener('click', function() {
                document.getElementById('chatMenuDropdown').classList.toggle('show');
            });
            
            // Initialize with welcome screen
            showScreen('welcomeScreen');
        }

        // ===== EVENT DELEGATION FOR DYNAMIC ELEMENTS =====
        document.addEventListener('click', function(event) {
            // Accept chat request
            if (event.target.closest('.accept-request-btn')) {
                const requestId = event.target.closest('.accept-request-btn').getAttribute('data-request-id');
                const request = chatRequests.find(req => req.id === requestId);
                
                if (request) {
                    // Add to contacts
                    addContact(request.senderId, request.senderName, request.senderProfileImage, request.senderIdFormatted);
                    
                    // Update request status
                    firebase.database().ref('chatRequests/' + currentUser.uid + '/' + requestId + '/status').set('accepted');
                    
                    // Create chat
                    startChatWithUser(request.senderId);
                    
                    showToast('Chat request accepted', 'success');
                }
            }
            
            // Reject chat request
            if (event.target.closest('.reject-request-btn')) {
                const requestId = event.target.closest('.reject-request-btn').getAttribute('data-request-id');
                
                // Update request status
                firebase.database().ref('chatRequests/' + currentUser.uid + '/' + requestId + '/status').set('rejected');
                
                showToast('Chat request rejected', 'info');
            }
            
            // Start chat from contact
            if (event.target.closest('.start-chat-btn')) {
                const contactId = event.target.closest('.start-chat-btn').getAttribute('data-contact-id');
                startChatWithUser(contactId);
            }
            
            // Remove contact
            if (event.target.closest('.remove-contact-btn')) {
                const contactId = event.target.closest('.remove-contact-btn').getAttribute('data-contact-id');
                const contact = contacts.find(c => c.id === contactId);
                
                if (contact) {
                    showConfirmation(
                        'Remove Contact',
                        `Remove ${contact.name} from your contacts?`,
                        'This will remove them from your contacts list, but you can add them again later.',
                        () => {
                            removeContact(contactId);
                        }
                    );
                }
            }
            
            // Open recent chat
            if (event.target.closest('.chat-card')) {
                const chatId = event.target.closest('.chat-card').getAttribute('data-chat-id');
                openChat(chatId);
            }
            
            // Open group chat
            if (event.target.closest('.open-group-btn')) {
                const groupId = event.target.closest('.open-group-btn').getAttribute('data-group-id');
                openGroupChat(groupId);
            }
            
            // Like zyne
            if (event.target.closest('.like-zyne-btn')) {
                const zyneId = event.target.closest('.like-zyne-btn').getAttribute('data-zyne-id');
                toggleLikeZyne(zyneId);
            }
            
            // Delete zyne
            if (event.target.closest('.delete-zyne-btn')) {
                const zyneId = event.target.closest('.delete-zyne-btn').getAttribute('data-zyne-id');
                
                showConfirmation(
                    'Delete Zyne',
                    'Delete this zyne?',
                    'This action cannot be undone.',
                    () => {
                        deleteZyne(zyneId);
                    }
                );
            }
        });

        // ===== HELPER FUNCTIONS =====
        async function addContact(userId, name, profileImage, userIdFormatted) {
            try {
                const contactData = {
                    id: userId,
                    name: name,
                    profileImage: profileImage || 'https://via.placeholder.com/150',
                    userId: userIdFormatted,
                    addedAt: Date.now()
                };
                
                await firebase.database().ref('contacts/' + currentUser.uid + '/' + userId).set(contactData);
                showToast(`${name} added to contacts`, 'success');
            } catch (error) {
                console.error('Error adding contact:', error);
                showToast('Error adding contact', 'error');
            }
        }

        async function removeContact(userId) {
            try {
                await firebase.database().ref('contacts/' + currentUser.uid + '/' + userId).remove();
                showToast('Contact removed', 'success');
            } catch (error) {
                console.error('Error removing contact:', error);
                showToast('Error removing contact', 'error');
            }
        }

        async function openGroupChat(groupId) {
            try {
                const groupRef = firebase.database().ref('groups/' + groupId);
                const snapshot = await groupRef.once('value');
                
                if (snapshot.exists()) {
                    const groupData = snapshot.val();
                    currentChat = { id: groupId, type: 'group', ...groupData };
                    
                    document.getElementById('chatUserName').textContent = groupData.name || 'Group Chat';
                    document.getElementById('chatProfilePic').src = groupData.profileImage || 'https://via.placeholder.com/36';
                    document.getElementById('chatStatusText').textContent = `${Object.keys(groupData.members || {}).length} members`;
                    
                    loadChatMessages(groupId);
                    showScreen('chatPage');
                }
            } catch (error) {
                console.error('Error opening group chat:', error);
                showToast('Error opening group chat', 'error');
            }
        }

        async function toggleLikeZyne(zyneId) {
            try {
                const zyneRef = firebase.database().ref('zynes/' + zyneId + '/likes/' + currentUser.uid);
                const snapshot = await zyneRef.once('value');
                
                if (snapshot.exists()) {
                    // Unlike
                    await zyneRef.remove();
                } else {
                    // Like
                    await zyneRef.set(true);
                }
            } catch (error) {
                console.error('Error toggling like:', error);
            }
        }

        async function deleteZyne(zyneId) {
            try {
                await firebase.database().ref('zynes/' + zyneId).remove();
                showToast('Zyne deleted', 'success');
            } catch (error) {
                console.error('Error deleting zyne:', error);
                showToast('Error deleting zyne', 'error');
            }
        }

        // ===== ZYNE CREATION =====
        document.getElementById('createZyneBtn').addEventListener('click', () => showModal('createZyneModal'));
        
        document.getElementById('zyneText').addEventListener('input', function() {
            document.getElementById('zyneCharCount').textContent = this.value.length;
        });
        
        document.getElementById('addZynePhotoBtn').addEventListener('click', () => {
            openCloudinaryUpload('image', (url) => {
                document.getElementById('zyneMediaUrl').value = url;
                document.getElementById('zyneMediaType').value = 'image';
                document.getElementById('zyneMediaPreview').innerHTML = `
                    <div class="preview-item">
                        <img src="${url}" alt="Zyne media">
                        <button class="remove-preview" id="removeZynePreviewBtn">&times;</button>
                    </div>
                `;
                document.getElementById('removeZyneMediaBtn').style.display = 'flex';
            });
        });
        
        document.getElementById('addZyneVideoBtn').addEventListener('click', () => {
            openCloudinaryUpload('video', (url) => {
                document.getElementById('zyneMediaUrl').value = url;
                document.getElementById('zyneMediaType').value = 'video';
                document.getElementById('zyneMediaPreview').innerHTML = `
                    <div class="preview-item">
                        <video src="${url}" controls></video>
                        <button class="remove-preview" id="removeZynePreviewBtn">&times;</button>
                    </div>
                `;
                document.getElementById('removeZyneMediaBtn').style.display = 'flex';
            });
        });
        
        document.getElementById('removeZyneMediaBtn').addEventListener('click', () => {
            document.getElementById('zyneMediaUrl').value = '';
            document.getElementById('zyneMediaType').value = '';
            document.getElementById('zyneMediaPreview').innerHTML = '';
            document.getElementById('removeZyneMediaBtn').style.display = 'none';
        });
        
        document.getElementById('postZyneBtn').addEventListener('click', async () => {
            const text = document.getElementById('zyneText').value.trim();
            const mediaUrl = document.getElementById('zyneMediaUrl').value;
            const mediaType = document.getElementById('zyneMediaType').value;
            
            if (!text && !mediaUrl) {
                showToast('Please add text or media to your zyne', 'error');
                return;
            }
            
            try {
                const zyneId = 'zyne_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const zyneData = {
                    id: zyneId,
                    userId: currentUser.uid,
                    userName: userData.name,
                    userProfileImage: userData.profileImage,
                    text: text,
                    mediaUrl: mediaUrl || null,
                    mediaType: mediaType || null,
                    timestamp: Date.now(),
                    likes: {},
                    comments: {}
                };
                
                await firebase.database().ref('zynes/' + zyneId).set(zyneData);
                
                showToast('Zyne posted successfully', 'success');
                hideModal('createZyneModal');
                
                // Reset form
                document.getElementById('zyneText').value = '';
                document.getElementById('zyneMediaUrl').value = '';
                document.getElementById('zyneMediaType').value = '';
                document.getElementById('zyneMediaPreview').innerHTML = '';
                document.getElementById('removeZyneMediaBtn').style.display = 'none';
                document.getElementById('zyneCharCount').textContent = '0';
                
            } catch (error) {
                console.error('Error posting zyne:', error);
                showToast('Error posting zyne', 'error');
            }
        });

        // ===== GROUP CREATION =====
        document.getElementById('createGroupBtn').addEventListener('click', () => showModal('createGroupModal'));
        
        document.getElementById('uploadGroupProfileBtn').addEventListener('click', () => {
            openCloudinaryUpload('image', (url) => {
                document.getElementById('groupProfileImageUrl').value = url;
                document.getElementById('groupProfilePreview').innerHTML = `<img src="${url}" alt="Group Profile Preview">`;
            });
        });
        
        let groupMembers = [];
        
        document.getElementById('addMemberBtn').addEventListener('click', async function() {
            const userIdInput = document.getElementById('addMemberInput').value.toUpperCase();
            
            if (!validateUserId(userIdInput)) {
                showToast('Please enter a valid User ID (ZYN-XXXX)', 'error');
                return;
            }
            
            try {
                // Find user by ID
                const userIdRef = firebase.database().ref('userIds/' + userIdInput);
                const snapshot = await userIdRef.once('value');
                
                if (!snapshot.exists()) {
                    showToast('User not found', 'error');
                    return;
                }
                
                const userUid = snapshot.val();
                
                // Check if already added
                if (groupMembers.includes(userUid)) {
                    showToast('User already added to group', 'info');
                    return;
                }
                
                // Get user info
                const userRef = firebase.database().ref('users/' + userUid);
                const userSnapshot = await userRef.once('value');
                
                if (userSnapshot.exists()) {
                    const userInfo = userSnapshot.val();
                    
                    // Add to members list
                    groupMembers.push(userUid);
                    
                    // Update UI
                    const membersList = document.getElementById('groupMembersList');
                    const emptyState = membersList.querySelector('.empty-members');
                    
                    if (emptyState) {
                        emptyState.remove();
                    }
                    
                    const memberElement = document.createElement('div');
                    memberElement.className = 'member-tag';
                    memberElement.innerHTML = `
                        <span>${userInfo.name}</span>
                        <button class="remove-member" data-user-id="${userUid}">&times;</button>
                    `;
                    
                    membersList.appendChild(memberElement);
                    
                    // Update count
                    document.querySelector('.members-count').textContent = `${groupMembers.length} members`;
                    
                    // Clear input
                    document.getElementById('addMemberInput').value = '';
                    
                    showToast(`${userInfo.name} added to group`, 'success');
                }
            } catch (error) {
                console.error('Error adding member:', error);
                showToast('Error adding member to group', 'error');
            }
        });
        
        document.getElementById('createGroupConfirmBtn').addEventListener('click', async function() {
            const groupName = document.getElementById('groupName').value.trim();
            const groupProfileImage = document.getElementById('groupProfileImageUrl').value;
            
            if (!groupName) {
                showToast('Please enter a group name', 'error');
                return;
            }
            
            if (groupMembers.length === 0) {
                showToast('Please add at least one member to the group', 'error');
                return;
            }
            
            try {
                const groupId = 'group_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // Create members object
                const members = {};
                members[currentUser.uid] = {
                    role: 'admin',
                    joinedAt: Date.now()
                };
                
                groupMembers.forEach(memberId => {
                    members[memberId] = {
                        role: 'member',
                        joinedAt: Date.now()
                    };
                });
                
                // Create group data
                const groupData = {
                    id: groupId,
                    name: groupName,
                    profileImage: groupProfileImage || 'https://via.placeholder.com/150',
                    createdBy: currentUser.uid,
                    createdAt: Date.now(),
                    lastActive: Date.now(),
                    members: members
                };
                
                // Save group
                await firebase.database().ref('groups/' + groupId).set(groupData);
                
                // Create group chat
                const chatId = 'chat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const chatData = {
                    id: chatId,
                    groupId: groupId,
                    type: 'group',
                    participants: members,
                    createdAt: Date.now(),
                    lastActive: Date.now(),
                    messages: {}
                };
                
                await firebase.database().ref('chats/' + chatId).set(chatData);
                
                showToast('Group created successfully', 'success');
                hideModal('createGroupModal');
                
                // Reset form
                document.getElementById('groupName').value = '';
                document.getElementById('groupProfileImageUrl').value = '';
                document.getElementById('groupProfilePreview').innerHTML = `
                    <div class="preview-placeholder">
                        <i class="fas fa-users"></i>
                        <span>No image selected</span>
                    </div>
                `;
                document.getElementById('groupMembersList').innerHTML = `
                    <div class="empty-members">
                        <i class="fas fa-user-plus"></i>
                        <p>Add members by User ID</p>
                    </div>
                `;
                document.querySelector('.members-count').textContent = '0 members';
                groupMembers = [];
                
            } catch (error) {
                console.error('Error creating group:', error);
                showToast('Error creating group', 'error');
            }
        });

        // ===== ADD CONTACT MODAL =====
        document.getElementById('addContactBtn').addEventListener('click', () => showModal('addContactModal'));
        
        document.getElementById('searchContactId').addEventListener('input', async function() {
            const userId = this.value.toUpperCase();
            const resultDiv = document.getElementById('contactSearchResult');
            
            if (!validateUserId(userId)) {
                resultDiv.innerHTML = `
                    <div class="search-placeholder">
                        <i class="fas fa-search"></i>
                        <p>Enter a valid User ID (ZYN-XXXX)</p>
                    </div>
                `;
                document.getElementById('sendContactRequestBtn').style.display = 'none';
                return;
            }
            
            try {
                // Find user by ID
                const userIdRef = firebase.database().ref('userIds/' + userId);
                const snapshot = await userIdRef.once('value');
                
                if (!snapshot.exists()) {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <p>User not found</p>
                        </div>
                    `;
                    document.getElementById('sendContactRequestBtn').style.display = 'none';
                    return;
                }
                
                const userUid = snapshot.val();
                
                // Check if already a contact
                if (contacts.some(contact => contact.id === userUid)) {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <p>User is already in your contacts</p>
                        </div>
                    `;
                    document.getElementById('sendContactRequestBtn').style.display = 'none';
                    return;
                }
                
                const userRef = firebase.database().ref('users/' + userUid);
                const userSnapshot = await userRef.once('value');
                
                if (userSnapshot.exists()) {
                    const userInfo = userSnapshot.val();
                    
                    resultDiv.innerHTML = `
                        <div class="user-found">
                            <img src="${userInfo.profileImage || 'https://via.placeholder.com/50'}" alt="${userInfo.name}" class="profile-pic">
                            <div>
                                <h4>${userInfo.name}</h4>
                                <p>${userInfo.userId}</p>
                            </div>
                        </div>
                    `;
                    
                    // Store found user data
                    resultDiv.setAttribute('data-found-user-id', userUid);
                    resultDiv.setAttribute('data-found-user-name', userInfo.name);
                    resultDiv.setAttribute('data-found-user-profile', userInfo.profileImage || '');
                    
                    document.getElementById('sendContactRequestBtn').style.display = 'block';
                }
            } catch (error) {
                console.error('Error searching user:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <p>Error searching for user</p>
                    </div>
                `;
                document.getElementById('sendContactRequestBtn').style.display = 'none';
            }
        });
        
        document.getElementById('sendContactRequestBtn').addEventListener('click', async function() {
            const resultDiv = document.getElementById('contactSearchResult');
            const foundUserId = resultDiv.getAttribute('data-found-user-id');
            
            if (!foundUserId) {
                showToast('Please search for a user first', 'error');
                return;
            }
            
            // This is the same as sending a chat request
            document.getElementById('sendChatRequestBtn').click();
        });

        // ===== INITIALIZE THE APP =====
        // The app is already initialized in DOMContentLoaded event
    </script>
</body>
</html>
