<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zynapse - Secure Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="zynaps.png" type="image/png">
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <img src="zynaps.png" alt="Zynapse Logo" class="loading-logo">
            <div class="spinner-large"></div>
            <p>Loading Zynapse...</p>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div class="auth-page" id="welcomeScreen">
        <div class="auth-container">
            <div class="welcome-screen">
                <img src="zynaps.png" alt="Zynapse Logo" class="logo-large">
                <h1>Zynapse</h1>
                <p class="tagline">Secure, private messaging for Zambia</p>
                <p class="tagline">End-to-end encrypted • Fast • Reliable</p>
                <p class="powered-by">Powered by Buffer Zone</p>
                
                <div class="welcome-actions">
                    <button class="btn-primary full-width" id="signupBtn">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                    <button class="btn-secondary full-width" id="loginBtn">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </div>
                
                <div class="welcome-footer">
                    <p>By continuing, you agree to our <a href="#" class="link">Terms</a> and <a href="#" class="link">Privacy Policy</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign Up Form -->
    <div class="auth-page" id="signupPage" style="display: none;">
        <div class="auth-container">
            <form class="auth-form" id="signupForm">
                <div class="auth-header">
                    <button type="button" class="back-btn" id="backToWelcomeFromSignup">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <img src="zynaps.png" alt="Zynapse Logo" class="logo-small">
                    <h2>Create Account</h2>
                    <p>Join Zynapse today</p>
                </div>
                
                <div class="auth-form-content">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="signupName" placeholder="Full Name" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-phone"></i>
                        <input type="tel" id="signupPhone" placeholder="Phone Number (+260)" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="signupEmail" placeholder="Email Address" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="signupPassword" placeholder="Password (min. 6 characters)" required minlength="6">
                        <i class="fas fa-eye toggle-password" data-target="signupPassword"></i>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="signupConfirmPassword" placeholder="Confirm Password" required minlength="6">
                        <i class="fas fa-eye toggle-password" data-target="signupConfirmPassword"></i>
                    </div>
                    
                    <div class="profile-upload-section">
                        <label class="upload-label">Profile Picture (Optional)</label>
                        <div class="profile-upload-container">
                            <div class="upload-preview" id="profilePreview">
                                <div class="preview-placeholder">
                                    <i class="fas fa-user-circle"></i>
                                    <span>No image selected</span>
                                    <p>Max 5MB</p>
                                </div>
                            </div>
                            <div class="upload-buttons">
                                <button type="button" class="btn-upload" id="uploadProfileBtn">
                                    <i class="fas fa-upload"></i> Choose Image
                                </button>
                                <button type="button" class="btn-remove" id="removeProfileBtn" style="display: none;">
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                            </div>
                        </div>
                        <input type="file" id="profilePicture" accept="image/*" style="display: none;">
                        <p class="upload-hint">Supported: JPG, PNG, GIF • Max 5MB</p>
                    </div>
                    
                    <div class="terms-agreement">
                        <label class="checkbox-container">
                            <input type="checkbox" id="agreeTerms" required>
                            <span class="checkmark"></span>
                            I agree to the <a href="#" class="link">Terms of Service</a> and <a href="#" class="link">Privacy Policy</a>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn-primary full-width" id="signupSubmitBtn">
                        <span>Create Account</span>
                        <div class="spinner" style="display: none;"></div>
                    </button>
                    
                    <div class="auth-switch">
                        Already have an account? <a href="#" class="link" id="switchToLogin">Sign In</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Form -->
    <div class="auth-page" id="loginPage" style="display: none;">
        <div class="auth-container">
            <form class="auth-form" id="loginForm">
                <div class="auth-header">
                    <button type="button" class="back-btn" id="backToWelcomeFromLogin">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <img src="zynaps.png" alt="Zynapse Logo" class="logo-small">
                    <h2>Welcome Back</h2>
                    <p>Sign in to your account</p>
                </div>
                
                <div class="auth-form-content">
                    <div class="input-group">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="loginEmail" placeholder="Email Address" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="loginPassword" placeholder="Password" required>
                        <i class="fas fa-eye toggle-password" data-target="loginPassword"></i>
                    </div>
                    
                    <div class="form-options">
                        <label class="checkbox-container">
                            <input type="checkbox" id="rememberMe">
                            <span class="checkmark"></span>
                            Remember me
                        </label>
                        <a href="#" class="link" id="forgotPassword">Forgot Password?</a>
                    </div>
                    
                    <button type="submit" class="btn-primary full-width" id="loginSubmitBtn">
                        <span>Sign In</span>
                        <div class="spinner" style="display: none;"></div>
                    </button>
                    
                    <div class="auth-switch">
                        Don't have an account? <a href="#" class="link" id="switchToSignup">Sign Up</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="app.js"></script>
    <script type="module">
        import zynapseApp from './app.js';
        
        document.addEventListener('DOMContentLoaded', function() {
            const loadingScreen = document.getElementById('loadingScreen');
            const welcomeScreen = document.getElementById('welcomeScreen');
            const signupPage = document.getElementById('signupPage');
            const loginPage = document.getElementById('loginPage');
            
            const signupBtn = document.getElementById('signupBtn');
            const loginBtn = document.getElementById('loginBtn');
            const backToWelcomeFromSignup = document.getElementById('backToWelcomeFromSignup');
            const backToWelcomeFromLogin = document.getElementById('backToWelcomeFromLogin');
            const switchToLogin = document.getElementById('switchToLogin');
            const switchToSignup = document.getElementById('switchToSignup');
            
            const signupForm = document.getElementById('signupForm');
            const loginForm = document.getElementById('loginForm');
            
            const profilePicture = document.getElementById('profilePicture');
            const uploadProfileBtn = document.getElementById('uploadProfileBtn');
            const removeProfileBtn = document.getElementById('removeProfileBtn');
            const profilePreview = document.getElementById('profilePreview');
            
            // Hide loading screen after 1.5 seconds
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 400);
            }, 1500);
            
            // Navigation between screens
            signupBtn.addEventListener('click', () => {
                welcomeScreen.style.display = 'none';
                signupPage.style.display = 'flex';
            });
            
            loginBtn.addEventListener('click', () => {
                welcomeScreen.style.display = 'none';
                loginPage.style.display = 'flex';
            });
            
            backToWelcomeFromSignup.addEventListener('click', () => {
                signupPage.style.display = 'none';
                welcomeScreen.style.display = 'flex';
            });
            
            backToWelcomeFromLogin.addEventListener('click', () => {
                loginPage.style.display = 'none';
                welcomeScreen.style.display = 'flex';
            });
            
            switchToLogin.addEventListener('click', (e) => {
                e.preventDefault();
                signupPage.style.display = 'none';
                loginPage.style.display = 'flex';
            });
            
            switchToSignup.addEventListener('click', (e) => {
                e.preventDefault();
                loginPage.style.display = 'none';
                signupPage.style.display = 'flex';
            });
            
            // Profile picture upload
            uploadProfileBtn.addEventListener('click', () => {
                profilePicture.click();
            });
            
            profilePicture.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        zynapseApp.showToast('File size must be less than 5MB', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profilePreview.innerHTML = `<img src="${e.target.result}" alt="Profile Preview">`;
                        removeProfileBtn.style.display = 'flex';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            removeProfileBtn.addEventListener('click', () => {
                profilePicture.value = '';
                profilePreview.innerHTML = `
                    <div class="preview-placeholder">
                        <i class="fas fa-user-circle"></i>
                        <span>No image selected</span>
                        <p>Max 5MB</p>
                    </div>
                `;
                removeProfileBtn.style.display = 'none';
            });
            
            // Password toggle
            document.querySelectorAll('.toggle-password').forEach(icon => {
                icon.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const input = document.getElementById(targetId);
                    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                    input.setAttribute('type', type);
                    this.classList.toggle('fa-eye');
                    this.classList.toggle('fa-eye-slash');
                });
            });
            
            // Sign up form submission
            signupForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const name = document.getElementById('signupName').value.trim();
                const phone = document.getElementById('signupPhone').value.trim();
                const email = document.getElementById('signupEmail').value.trim();
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('signupConfirmPassword').value;
                const agreeTerms = document.getElementById('agreeTerms').checked;
                
                // Validation
                if (!name || !phone || !email || !password) {
                    zynapseApp.showToast('Please fill in all required fields', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    zynapseApp.showToast('Passwords do not match', 'error');
                    return;
                }
                
                if (!agreeTerms) {
                    zynapseApp.showToast('You must agree to the terms and conditions', 'error');
                    return;
                }
                
                if (!phone.startsWith('+260')) {
                    zynapseApp.showToast('Phone number must start with +260', 'error');
                    return;
                }
                
                // Show loading state
                const submitBtn = document.getElementById('signupSubmitBtn');
                const btnText = submitBtn.querySelector('span');
                const spinner = submitBtn.querySelector('.spinner');
                btnText.textContent = 'Creating Account...';
                spinner.style.display = 'block';
                submitBtn.disabled = true;
                
                try {
                    const profileFile = profilePicture.files[0];
                    const result = await zynapseApp.signUp(name, phone, email, password, profileFile);
                    
                    if (result.success) {
                        zynapseApp.showToast('Account created successfully!', 'success');
                        // Redirect happens automatically via auth state change
                    } else {
                        zynapseApp.showToast(result.message, 'error');
                    }
                } catch (error) {
                    zynapseApp.showToast('An error occurred. Please try again.', 'error');
                } finally {
                    btnText.textContent = 'Create Account';
                    spinner.style.display = 'none';
                    submitBtn.disabled = false;
                }
            });
            
            // Login form submission
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;
                
                if (!email || !password) {
                    zynapseApp.showToast('Please enter email and password', 'error');
                    return;
                }
                
                // Show loading state
                const submitBtn = document.getElementById('loginSubmitBtn');
                const btnText = submitBtn.querySelector('span');
                const spinner = submitBtn.querySelector('.spinner');
                btnText.textContent = 'Signing In...';
                spinner.style.display = 'block';
                submitBtn.disabled = true;
                
                try {
                    const result = await zynapseApp.login(email, password);
                    
                    if (result.success) {
                        zynapseApp.showToast('Signed in successfully!', 'success');
                        // Redirect happens automatically via auth state change
                    } else {
                        zynapseApp.showToast(result.message, 'error');
                    }
                } catch (error) {
                    zynapseApp.showToast('An error occurred. Please try again.', 'error');
                } finally {
                    btnText.textContent = 'Sign In';
                    spinner.style.display = 'none';
                    submitBtn.disabled = false;
                }
            });
            
            // Forgot password
            document.getElementById('forgotPassword').addEventListener('click', function(e) {
                e.preventDefault();
                zynapseApp.showToast('Password reset feature coming soon', 'info');
            });
        });
    </script>
</body>
</html>
